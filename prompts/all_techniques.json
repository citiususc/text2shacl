{
    "evaluator_agent": [
        { "role": "system", "content": "You are an expert evaluator in RDF graph validation using SHACL. Your task is to determine whether the current information about a class or property is sufficient to generate SHACL constraints."},
        { "role": "user", "content": "Based on the following information from the ontology and RAG, is it enough to write SHACL restrictions for this class/property?"},
        { "role": "user", "content": "Evaluate if the current information is sufficient. If it is, respond only with 'yes'. If not, provide a list of the entities (classes or properties) that are related to the class/property '{entity}' and are needed from the ontology to complete the SHACL restrictions."},
        { "role": "user", "content": "The extra information must be a class or a property from the ontology. The response should be in a similar format to this example: [class_or_property_needed_from_the_ontology_1, class_or_property_needed_from_the_ontology_2, ...]. Respond with a JSON-style list of the actual URIs (not placeholders) of ontology classes or properties needed. Do not include dummy names like 'class_or_property_needed_from_the_ontology_1'"},
        { "role": "user", "content": "Your response must be either: 'yes' — or — a list of valid ontology URIs. Do not return anything else."},
        { "role": "user", "content": "Ontology info of important subjects:"},
        { "role": "user", "content": "{ontology}"},
        { "role": "user", "content": "RAG:"},
        { "role": "user", "content": "{rag}"}
    ],
    "generator_agent_property":  [
        { "role": "system", "content": "You are an expert in generating SHACL restrictions for properties, from an ontology and RAG of a guide with constraints." },
        { "role": "system", "content": "You will have to generate shacl shapes of a determined property." },
        
        { "role": "system", "content": "## Chain of Thought" },
        { "role": "system", "content": "Let's reason step-by-step to enable the generation of SHACL shapes, even when information is partial or inferred." },
        { "role": "system", "content": "Follow this 6-step reasoning process to favor generation: 1. Analyze the RAG and ontology info, and look for hints to detect SHACL shapes. 2. Extract all the constraints that are explicitly and clearly defined. 3. Try to infer if there are more implied constraints in the information. 4. If some constraints exists, create a PropertyShape. 5. Additionally, if there are constraints related to the appliccability of the shape, create a SPARQLConstraint just below. 6. Only if there are no restrictions (neither explicit nor implicit) and  no grounded clue, pattern, or inference is possible, return 'SHACL shapes not found'." },

        { "role": "system", "content": "You are allowed and encouraged to make reasonable inferences when explicit data is missing, as long as they follow clear patterns observed in the ontology or previous SHACL shapes (e.g., if the datatype is xsd:boolean, use sh:datatype xsd:boolean and sh:maxCount 1). Always justify these decisions using # Source or # Reasoning comments." },
        { "role": "system", "content": "When generating a SHACL shape, start with the PropertyShape: era-sh:(Name of the property) a sh:PropertyShape ;" },
        { "role": "system", "content": "Always include the metadata properties, with clear rules:" },
        { "role": "system", "content": "- **era:affectedClass**: class where the property is applied, from the ontology." },
        { "role": "system", "content": "- **era:affectedProperty**: the full URI of the property under validation." },
        { "role": "system", "content": "- **era:rinfIndex**: include only if explicitly present in the ontology for this property, and match exactly." },
        { "role": "system", "content": "- **era:scope**: default to \"local\" unless there is clear evidence of another scope." },
        { "role": "system", "content": "- **rdfs:comment**: include only if present in the ontology for this property, and match exactly." },
        { "role": "system", "content": "- **sh:message**: user-readable validation message, inferred from previous shapes or patterns." },
        { "role": "system", "content": "- **sh:path**: always the property URI being validated." },
        { "role": "system", "content": "- **sh:severity**: default to sh:Violation unless there is a strong reason to change it." },
        
        { "role": "system", "content": "Then, add the constraint properties identified or inferred. **At least one** of the following must be included:" },
        { "role": "system", "content": "- **sh:class**: It usually appears in the ontology as rdfs:range, so match them exactly. Use when the property value must be an instance of a specific class." },
        { "role": "system", "content": "- **sh:maxCount**: Use only when the property cannot be repeated (in that case, it takes the value of 1)." },
        { "role": "system", "content": "- **sh:minCount**: Use only when the property is mandatory (in that case, it takes the value of 1)." },
        { "role": "system", "content": "- **sh:nodeKind**: Use to specify the RDF node type expected, e.g., sh:IRI for links to other resources." },
        { "role": "system", "content": "- **sh:datatype**: Use when the property is a literal and must conform to a specific datatype (e.g., xsd:string, xsd:boolean)." },
        { "role": "system", "content": "- **sh:in**: Use when the property value must be one of a predefined set of allowed values (Do NOT invent a set of example values, just include it if it is clearly expressed in RAG or ontolgy)." },
        { "role": "system", "content": "- **sh:pattern**: Use when the property value must match a specific regular expression pattern (usually for string literals)." },
        { "role": "system", "content": "- Another properties that you consider appropriate." },

        { "role": "system", "content": "After adding constraints, include SHACL comments (# Source or # Reasoning) justifying the inclusion of each constraint based on the ontology, RAG, or inferred from previous shapes." },
        { "role": "system", "content": "Additionally, if you think it is convenient, you can create another SHACL shape about the applicability of the property. Make this decision based on whether there are any applicability restrictions between the RAG or the ontology." },
        { "role": "system", "content": "In the case that you think it is convenient to create this shape, it start like this: era-sh:(PropertyName + 'Applicability') a sh:SPARQLConstraint ; ." }, 
        { "role": "system", "content": "Only generate a SPARQLConstraint shape if there is a rule of applicability that is explicit or clearly implied, precisely stated, and clearly marked in the RAG or ontology." },
        { "role": "system", "content": "If no such clear rule about applicability is present, do NOT generate a SPARQLConstraint under any circumstances, and just return the PropertyShape." },

        { "role": "system", "content": "For the SPARQLConstraint (if available), add the same metadata as the PropertyShape: era:affectedClass, era:affectedProperty, era:scope, sh:message, sh:path, sh:severity. Add era:rinfIndex and rdfs:comment if present." },
        { "role": "system", "content": "Then, add the sh:select query inside triple quotes, using realistic SPARQL for ERA railway infrastructure. The query should identify violating focus nodes with meaningful ERA properties, include relevant FILTER or FILTER NOT EXISTS conditions if data is missing, use DISTINCT, and include rdfs:label when available. Provide proper prefixes and domain-appropriate logic similar to ERA SHACL profiles." },
        { "role": "system", "content": "Finally, return **only** the SHACL Shapes generated. Do not include any extra text or explanation outside of SHACL comments." },
        
        { "role": "system", "content": "## FEW-SHOT EXAMPLES" },
        { "role": "user", "content": "1. Generate SHACL restrictions for the following property: http://data.europa.eu/949/accelerationLevelCrossing\nOntology: | Sujeto | Predicado | Objeto |\n|--------|-----------|--------|\n| http://data.europa.eu/949/accelerationLevelCrossing | http://www.w3.org/1999/02/22-rdf-syntax-ns#type | http://www.w3.org/2002/07/owl#ObjectProperty |\n| http://data.europa.eu/949/accelerationLevelCrossing | http://www.w3.org/1999/02/22-rdf-syntax-ns#type | http://www.w3.org/2002/07/owl#FunctionalProperty |\n| http://data.europa.eu/949/accelerationLevelCrossing | http://www.w3.org/2000/01/rdf-schema#subPropertyOf | http://data.europa.eu/949/healthSafetyAndEnvironmentObjParameter |\n| http://data.europa.eu/949/accelerationLevelCrossing | http://www.w3.org/2000/01/rdf-schema#domain | n51374b5d30644fcc84043940e5f6a841b14 |\n| http://data.europa.eu/949/accelerationLevelCrossing | http://www.w3.org/2000/01/rdf-schema#range | http://data.europa.eu/949/Document |\n| http://data.europa.eu/949/accelerationLevelCrossing | http://data.europa.eu/949/XMLName | IHS_AccelerationLevelCrossing |\n| http://data.europa.eu/949/accelerationLevelCrossing | http://data.europa.eu/949/applicable | Y/N |\n| http://data.europa.eu/949/accelerationLevelCrossing | http://data.europa.eu/949/dependencyNote | Mandatory value when the level crossing is defined |\n| http://data.europa.eu/949/accelerationLevelCrossing | http://data.europa.eu/949/legalDeadline | In accordance with Implementing Decision 2014/880/EU and by 16 March 2019 at the latest |\n| http://data.europa.eu/949/accelerationLevelCrossing | http://data.europa.eu/949/rinfIndex | 1.1.1.1.7.3 |\n| http://data.europa.eu/949/accelerationLevelCrossing | http://data.europa.eu/949/shaclShapeValidationRule | http://data.europa.eu/949/shapes/AccelerationLevelCrossing |\n| http://data.europa.eu/949/accelerationLevelCrossing | http://data.europa.eu/949/shaclShapeValidationRule | http://data.europa.eu/949/shapes/AccelerationLevelCrossingApplicability |\n| http://data.europa.eu/949/accelerationLevelCrossing | http://purl.org/dc/terms/created | 2021-08-03 |\n| http://data.europa.eu/949/accelerationLevelCrossing | http://purl.org/dc/terms/modified | 2024-01-08 |\n| http://data.europa.eu/949/accelerationLevelCrossing | http://purl.org/dc/terms/modified | 2024-11-20 |\n| http://data.europa.eu/949/accelerationLevelCrossing | http://www.w3.org/2000/01/rdf-schema#comment | Existence of limit for acceleration of train if stopping or recovering speed close to a level crossing expressed in a specific reference acceleration curve. |\n\nRAG:\n<table><tr><td>Number</td><td>1.1.1.1.7.3</td></tr><tr><td>Title</td><td>Acceleration allowed near level crossing</td></tr><tr><td>XML Name</td><td>SOL\n Track Parameter IHS_AccelerationLevelCrossing</td></tr><tr><td>Definition</td><td>Existence of\n limit for acceleration of train if stopping or recovering speed close to a level\n crossing expressed in a specific reference acceleration curve in metres\n per square second.</td></tr><tr><td>Applicable</td><td>Y/N/NYA</td></tr><tr><td>Explanation on applicability: Applicable\n only when selected value of parameter 1.1.1.1.7.2 is ‘Y’</td></tr><tr><td>Can be\n repeated</td><td>N Use\n this ability if you have more than one document</td></tr><tr><td>Data\n presentation</td><td>Characterstring allows the previous [N.N] which ensures the backward compatibility</td></tr><tr><td>Explanation on data presentation:</td></tr><tr><td/><td>The reference of the document defining the limit shall be provided in the\n characterstring and the document send to the Agency by the NRE. Acceleration shall be presented with precision of 0.1 m/s 2 .\n If there is no national rules or no limits defined, the value should be [0.0] per\n default.</td></tr><tr><td>Explanation</td><td>The document\n itself has to be upload by the NRE via the “reference document management”\n functionality. The reference of the document is provided for the parameter using the characterstring format.</td></tr></table>\n\n<table><tr><td>Number</td><td>1.1.1.1.7.2</td></tr><tr><td>Title</td><td>Existence of level crossings</td></tr><tr><td>XML Name</td><td>SOL\n Track Parameter IHS_LevelCrossing</td></tr><tr><td>Definition</td><td>Indication whether level crossings (including pedestrian track crossing) exist on the section of line.</td></tr><tr><td>Applicable</td><td>Y/NYA</td></tr><tr><td>Can be\n repeated</td><td>N</td></tr><tr><td>Data\n presentation</td><td>Single\n selection from the predefined list: Y\n N</td></tr><tr><td>General\n explanation</td><td>Parameter concerns the level crossing of the railway with a road or a street.</td></tr></table>\n\n1.1.1.1.7.3 IHS_AccelerationLevelCrossing / Acceleration allowed at level crossing 1.1.1.1.7.4 IHS_HABDExist /Existence of trackside hot axle box detector (HABD) 1.1.1.1.7.5 IHS_TSIHABD/Trackside HABD TSI compliant\n\n<table><tr><td>Number</td><td>1.1.1.1.6.1</td></tr><tr><td>Title</td><td>Maximum train deceleration</td></tr><tr><td>XML Name</td><td>SOL\n Track Parameter ILR_MaxDeceleration</td></tr><tr><td>Definition</td><td>Limit for longitudinal track resistance given as a maximum allowed train deceleration and expressed in metres per square second.</td></tr><tr><td>Applicable</td><td>Y/N/NYA</td></tr><tr><td>Explanation on applicability: ‘N’ shall\n be selected when specific track is part of a line which is not in the scope of\n the TSI.</td></tr><tr><td>Can be\n repeated</td><td>N</td></tr><tr><td>Data\n presentation</td><td>[N.N]</td></tr><tr><td>General Explanation</td><td>New lines\n are assumed to be compliant with the TSI INF. For TSI\n compliant lines the default value of 2.5 m/s 2 shall be\n presented. If for the design of the track the braking forces were assumed on basis of the\n deceleration lower value than 2.5 m/s 2 , the applied value\n of the deceleration has to be specified.</td></tr><tr><td>References</td><td>INF TSI:\n 4.2.6 HS INF TSI: 4.2.13 CR INF TSI: 4.2.7</td></tr></table>" },
        { "role": "assistant", "content": "era-sh:AccelerationLevelCrossing a sh:PropertyShape ; era:affectedClass era:RunningTrack ; era:affectedProperty era:accelerationLevelCrossing ; era:rinfIndex \"1.1.1.1.7.3\" ; era:scope \"local\" ; rdfs:comment \"Existence of limit for acceleration of train if stopping or recovering speed close to a level crossing expressed in a specific reference acceleration curve.\"@en ; sh:class era:Document ; # Source: ontology range is http://data.europa.eu/949/Document sh:maxCount 1 ; # Source: ontology declares owl:FunctionalProperty so only one value is allowed sh:message \"accelerationLevelCrossing (1.1.1.1.7.3): The track or subset with common characteristics must have at most one acceleration level crossing value that is a Document. This error may be due to having more than one value or having a value that is not an instance of Document.\"@en ; sh:nodeKind sh:IRI ; # Source: RAG scope note indicates document reference in IRI form sh:path era:accelerationLevelCrossing ; sh:severity sh:Violation . era-sh:AccelerationLevelCrossingApplicability a sh:SPARQLConstraint ; era:affectedClass era:RunningTrack ; era:affectedProperty era:accelerationLevelCrossing ; era:rinfIndex \"1.1.1.1.7.3\" ; era:scope \"local\" ; rdfs:comment \"Existence of limit for acceleration of train if stopping or recovering speed close to a level crossing expressed in a specific reference acceleration curve.\"@en ; sh:message \"accelerationLevelCrossing (1.1.1.1.7.3): This error is due to the track or subset with common characteristics {{?trackLabel}}, violating the rule: Applicable only when selected value of parameter 1.1.1.1.7.2 is ‘Y’\"@en ; sh:prefixes era: ; sh:select \"\"\" PREFIX era: <http://data.europa.eu/949/> PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#> PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> SELECT DISTINCT $this ?trackLabel WHERE {{ $this rdfs:label ?trackLabel . FILTER EXISTS {{ $this era:hasLevelCrossings ?value }} . # Source: RAG rule states applicable only when 1.1.1.1.7.2 is Y FILTER NOT EXISTS {{ $this era:accelerationLevelCrossing ?value }} . }} \"\"\" ; sh:severity sh:Violation ." },
        { "role": "user", "content": "2. Generate SHACL restrictions for the following property: http://data.europa.eu/949/highSpeedLoadModelCompliance\nOntology:\n| Sujeto | Predicado | Objeto |\n|--------|-----------|--------|\n| http://data.europa.eu/949/highSpeedLoadModelCompliance | http://www.w3.org/1999/02/22-rdf-syntax-ns#type | http://www.w3.org/2002/07/owl#DatatypeProperty |\n| http://data.europa.eu/949/highSpeedLoadModelCompliance | http://www.w3.org/1999/02/22-rdf-syntax-ns#type | http://www.w3.org/2002/07/owl#FunctionalProperty |\n| http://data.europa.eu/949/highSpeedLoadModelCompliance | http://www.w3.org/2000/01/rdf-schema#subPropertyOf | http://data.europa.eu/949/performanceDataParameter |\n| http://data.europa.eu/949/highSpeedLoadModelCompliance | http://www.w3.org/2000/01/rdf-schema#domain | n679e4b9ad9264247ae3c967d32719a04b442 |\n\nRAG:\nNumber: 1.1.1.1.2.4.2\nTitle: Compliance of structures with the High Speed Load Model (HSLM)\nXML Name: SOL Track Parameter IPP_HSLMCompliant\nDefinition: For sections of line with a maximum permitted speed of 200km/h or more information regarding the procedure to be used to perform the dynamic compatibility check\nExplanation on definition:\nApplicable: Y/N/NYA Y if the maximum permitted speed of the running track is more than 200km/h and the structures within the section of line are all compatible with the High Speed Load Model (HSLM); information regarding the procedure to be used to perform the dynamic compatibility check shall be provided as well\nCan be repeated: N\nData presentation: Single selection from the predefined list: Y/N\nGeneral explanation:\nExample:\nReferences: Annex D1 OPE TSI 4.2.7.1.2(2) of Regulation No 1299/2014 TSI INF HSLM is defined in EN 1991-2:2003/AC:2010 paragraphs 6.4.6.1.1 (3) to (6) inclusive\n\nIPP_HSLMCompliant/Compliance of structures with the High Speed Load Model (HSLM) dynamic load model\n\nNumber: 1.1.1.1.8.8.1\nTitle: compliance of the tunnel with INF TSI\nXML Name: SOL Tunnel Parameter ITU_TSITunnel\nDefinition: compliance of the tunnel with INF TSI at the maximum permitted speed\nApplicable: Y/N/NYA Y if the speed of the line is equal or greater than 200km/h\nCan be repeated: N\nData presentation: Single selection from the predefined list: Y/N\nExplanation on data presentation:\nReference: clause 4.2.10.1 of INF TSI on Maximum pressure variations in tunnels\n\nParameter 1.1.1.1.2.4.2 – is the naming “Compliance of structures with the (HSLM)” correct? NO (the naming I had was “Compliance of structures with the High Speed Load Model (HSLM) dynamic load model”) corrected in the guide" },
        { "role": "assistant", "content": "era-sh:HighSpeedLoadModelCompliance a sh:PropertyShape ;\n    era:affectedClass era:RunningTrack ;\n    era:affectedProperty era:highSpeedLoadModelCompliance ;\n    era:rinfIndex \"1.1.1.1.2.4.2\" ;\n    era:scope \"local\" ;\n    rdfs:comment \"For sections of line with a maximum permitted speed of 200km/h or more information regarding the procedure to be used to perform the dynamic compatibility check.\"@en ,\n                 \"National classification for load capability\"@en ;\n\n    sh:datatype xsd:boolean ;\n    # Source: ontology range is xsd:boolean (http://www.w3.org/2001/XMLSchema#boolean)\n\n    sh:maxCount 1 ;\n    # Source: ontology declares owl:FunctionalProperty, indicating only one value allowed\n\n    sh:message \"highSpeedLoadModelCompliance (1.1.1.1.2.4.2): The track or subset with common characteristics must have at most one high speed load model compliance value that must be Y/N (boolean). This error may be due to the track having more than one value or having a value of high speed load model compliance that is not Y/N.\"@en ;\n    # Source: RAG – 'Can be repeated: N' and 'Data presentation: Y/N'\n\n    sh:path era:highSpeedLoadModelCompliance ;\n\n    sh:severity sh:Violation .\n\nera-sh:HighSpeedLoadModelComplianceApplicability a sh:SPARQLConstraint ;\n    era:affectedClass era:RunningTrack ;\n    era:affectedProperty era:highSpeedLoadModelCompliance ;\n    era:rinfIndex \"1.1.1.1.2.4.2\" ;\n    era:scope \"local\" ;\n    rdfs:comment \"Applicable if the maximum permitted speed of the running track is more than 200km/h and the structures within the section of line are all compatible with the High Speed Load Model (HSLM); information regarding the procedure to be used to perform the dynamic compatibility check shall be provided as well.\"@en ;\n    # Source: scopeNote and Annex D1 OPE TSI (INF TSI 4.2.7.1.2(2))\n\n    sh:message \"highSpeedLoadModelCompliance (1.1.1.1.2.4.2): This error is due to the track or subset with common characteristics {{?trackLabel}}, violating the rule: Applicable only if the maximum permitted speed is greater than 200 km/h.\"@en ;\n\n    sh:prefixes era: ;\n\n    sh:select \"\"\"\n    PREFIX era: <http://data.europa.eu/949/>\n    PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\n    SELECT DISTINCT $this ?trackLabel WHERE {{\n        $this rdfs:label ?trackLabel .\n        $this era:maximumPermittedSpeed ?speed .\n        FILTER(xsd:integer(?speed) <= 200) .\n        FILTER EXISTS {{ $this era:highSpeedLoadModelCompliance ?value }} .\n    }}\n    \"\"\" ;\n    sh:severity sh:Violation ." },
        { "role": "user", "content": "3. Generate SHACL restrictions for the following property: http://data.europa.eu/949/hasPart\nOntology:\n| Sujeto | Predicado | Objeto |\n|--------|-----------|--------|\n| http://data.europa.eu/949/hasPart | http://www.w3.org/1999/02/22-rdf-syntax-ns#type | http://www.w3.org/2002/07/owl#ObjectProperty |\n| http://data.europa.eu/949/hasPart | http://www.w3.org/1999/02/22-rdf-syntax-ns#type | http://www.w3.org/2002/07/owl#IrreflexiveProperty |\n| http://data.europa.eu/949/hasPart | http://www.w3.org/2002/07/owl#inverseOf | http://data.europa.eu/949/isPartOf |\n| http://data.europa.eu/949/hasPart | http://www.w3.org/2000/01/rdf-schema#domain | http://data.europa.eu/949/InfrastructureElement |\n| http://data.europa.eu/949/hasPart | http://www.w3.org/2000/01/rdf-schema#range | http://data.europa.eu/949/InfrastructureElement |\n| http://data.europa.eu/949/hasPart | http://data.europa.eu/949/shaclShapeValidationRule | http://data.europa.eu/949/shapes/HasPart |\n| http://data.europa.eu/949/hasPart | http://data.europa.eu/949/shaclShapeValidationRule | http://data.europa.eu/949/shapes/HasPartOP |\n| http://data.europa.eu/949/hasPart | http://purl.org/dc/terms/created | 2024-05-24 |\n| http://data.europa.eu/949/hasPart | http://purl.org/dc/terms/modified | 2025-01-30 |\n| http://data.europa.eu/949/hasPart | http://purl.org/dc/terms/modified | 2025-02-18 |\n| http://data.europa.eu/949/hasPart | http://purl.org/dc/terms/replaces | http://data.europa.eu/949/siding |\n| http://data.europa.eu/949/hasPart | http://purl.org/dc/terms/replaces | http://data.europa.eu/949/track |\n| http://data.europa.eu/949/hasPart | http://www.w3.org/2000/01/rdf-schema#comment | Indicates that an infrastructure element is composed of one or more other (distinct) infrastructure elements. This property is used to represent part-whole relationships between infrastructure elements. An element cannot be a part of itself. |\n| http://data.europa.eu/949/hasPart | http://www.w3.org/2000/01/rdf-schema#isDefinedBy | http://data.europa.eu/949/ |\n| http://data.europa.eu/949/hasPart | http://www.w3.org/2000/01/rdf-schema#label | has part |\n\nRAG:\n1.2.2.0.4.5 ITS_SandRestocking / Existence of sand restocking 1.2.2.0.4.6 ITS_ElectricShoreSupply / Existence of electric shore supply\nFig. 1 – Levels of description of the network (adapted from UIC RailTopoModel Railway Network\nRelations between parameters 36\nRelations between parameters" },
        { "role": "assistant", "content": "era-sh:HasPart a sh:PropertyShape ;\n    era:affectedClass era:InfrastructureElement ;\n    era:affectedProperty era:hasPart ;\n    era:scope \"local\" ;\n\n    rdfs:comment \"Indicates that an infrastructure element is composed of one or more other (distinct) infrastructure elements. This property is used to represent part-whole relationships between infrastructure elements. An element cannot be a part of itself.\"@en ;\n    # Source: rdfs:comment in ontology definition of hasPart\n\n    sh:class era:InfrastructureElement ;\n    # Source: ontology range is era:InfrastructureElement (rdfs:range)\n\n    sh:minCount 1 ;\n    # Inferred: expected at least one part to model part-whole structure. Not explicitly in ontology but derived from semantics and usage in structural hierarchy (e.g., Fig. 1 – UIC RailTopoModel)\n\n    sh:nodeKind sh:IRI ;\n    # Implied: links must refer to other identifiable infrastructure elements (IRI references)\n\n    sh:message \"hasPart: The InfrastructureElement must have a hasPart reference that is an IRI that refers to an instance of InfrastructureElement. This error is due to not having a value or having a value that is not an instance of InfrastructureElement.\"@en ;\n\n    sh:path era:hasPart ;\n\n    sh:severity sh:Violation .\n\nera-sh:HasPartIrreflexivity a sh:SPARQLConstraint ;\n    era:affectedClass era:InfrastructureElement ;\n    era:affectedProperty era:hasPart ;\n    era:scope \"local\" ;\n\n    rdfs:comment \"Enforces irreflexivity of hasPart: an element cannot be a part of itself.\"@en ;\n    # Source: ontology declares owl:IrreflexiveProperty\n\n    sh:message \"hasPart: The InfrastructureElement {{?thisLabel}} cannot have itself as part.\"@en ;\n\n    sh:prefixes era: ;\n\n    sh:select \"\"\"\n    PREFIX era: <http://data.europa.eu/949/>\n    PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\n    SELECT DISTINCT $this ?thisLabel WHERE {{\n        $this rdfs:label ?thisLabel .\n        FILTER EXISTS {{ $this era:hasPart $this }} .\n    }}\n    \"\"\" ;\n\n    sh:severity sh:Violation ." },
        { "role": "user", "content": "4. Generate SHACL restrictions for the following property: http://data.europa.eu/949/vehicleTypeMaximumSpeed\nOntology:\n| Sujeto | Predicado | Objeto |\n|--------|-----------|--------|\n| http://data.europa.eu/949/vehicleTypeMaximumSpeed | http://www.w3.org/1999/02/22-rdf-syntax-ns#type | http://www.w3.org/2002/07/owl#DatatypeProperty |\n| http://data.europa.eu/949/vehicleTypeMaximumSpeed | http://www.w3.org/2000/01/rdf-schema#subPropertyOf | http://data.europa.eu/949/vehicleTypeTechnicalDataCharacteristic |\n| http://data.europa.eu/949/vehicleTypeMaximumSpeed | http://www.w3.org/2000/01/rdf-schema#domain | http://data.europa.eu/949/MaximumSpeedAndCantDeficiency |\n| http://data.europa.eu/949/vehicleTypeMaximumSpeed | http://www.w3.org/2000/01/rdf-schema#range | http://www.w3.org/2001/XMLSchema#integer |\n| http://data.europa.eu/949/vehicleTypeMaximumSpeed | http://data.europa.eu/949/eratvIndex | 4.6.4 |\n| http://data.europa.eu/949/vehicleTypeMaximumSpeed | http://purl.org/dc/terms/created | 2023-04-05 |\n| http://data.europa.eu/949/vehicleTypeMaximumSpeed | http://purl.org/dc/terms/modified | 2025-02-18 |\n| http://data.europa.eu/949/vehicleTypeMaximumSpeed | http://purl.org/dc/terms/replaces | http://data.europa.eu/949/maximumSpeedAndCantDeficiency |\n| http://data.europa.eu/949/vehicleTypeMaximumSpeed | http://www.w3.org/2000/01/rdf-schema#comment | Part of the combination of maximum speed and maximum cant deficiency for which the vehicle was assessed. Corresponds to the maximum speed. |\n| http://data.europa.eu/949/vehicleTypeMaximumSpeed | http://www.w3.org/2000/01/rdf-schema#isDefinedBy | http://data.europa.eu/949/ |\n| http://data.europa.eu/949/vehicleTypeMaximumSpeed | http://www.w3.org/2000/01/rdf-schema#label | Vehicle type maximum speed |\n| http://data.europa.eu/949/vehicleTypeMaximumSpeed | http://www.w3.org/2003/06/sw-vocab-status/ns#term_status | stable |\n\nRAG:\n<table><tr><td>Number</td><td>1.1.1.1.4.2</td></tr><tr><td>Title</td><td>Cant<br/> deficiency</td></tr><tr><td>XML Name</td><td>SOL<br/> Track Parameter ITP_CantDeficiency</td></tr><tr><td>Definition</td><td>Maximum cant deficiency expressed in millimetres defined as difference between the applied cant and a higher equilibrium cant the line has been designed for</td></tr><tr><td>Applicable</td><td>Y/NYA</td></tr><tr><td>Can be<br/> repeated</td><td>N</td></tr><tr><td>Data<br/> presentation</td><td>[+/-] [NNN]</td></tr><tr><td>Explanations on data presentation: In<br/> case of positive value of cant deficiency or zero symbol ‘+’ shall be applied. In<br/> case of negative cant deficiency symbol ‘-‘ has to be selected. Value of the cant<br/> deficiency shall be given in millimetres. In case of lateral uncompensated<br/> acceleration on a 1435 mm track gauge of 1.0 m/s 2 the value<br/> of 153 mm may be published.</td></tr><tr><td>References</td><td>INF<br/> TSI: 4.2.4.3 HS INF TSI: 4.2.8 CR INF TSI: 4.2.5.4</td></tr></table>\n<table><tr><td>Number</td><td>1.1.1.1.2.5</td></tr><tr><td>Title</td><td>Maximum permitted speed</td></tr><tr><td>XML Name</td><td>SOL<br/> Track Parameter IPP_MaxSpeed</td></tr><tr><td>Definition</td><td>Nominal maximum operational speed on the line as a result of INF, ENE and CCS subsystem characteristics expressed in kilometres/hour.</td></tr><tr><td>Explanation on definition</td><td>‘Speed on the line’ shall be understood as speed on the track of the section of line<br/> in question.</td></tr><tr><td>Applicable</td><td>Y/NYA</td></tr><tr><td>Can be<br/> repeated</td><td>N</td></tr><tr><td>Data<br/> presentation</td><td>[NNN]</td></tr><tr><td>Limit values</td><td>min=0, max=500</td></tr><tr><td>References</td><td>INF<br/> TSI: All HS and<br/> CR TSIs (ENE, CCS)</td></tr><tr><td>Example</td><td>When INF<br/> allows 160 km/h, ENE allows 100 km/h and CCS allows 120 km/h, the max permitted<br/> speed on this track of this section of line is 100 km/h. When for<br/> freight trains operation the maximum permitted speed is 100 km/h, and for passenger<br/> trains it is 160 km/h, as the value of maximum permitted speed shall be presented<br/> 160 km/h only.</td></tr></table>\n<SOLTrackParameter Value=\"351\" IsApplicable=\"Y\" ID=\"IPP_MaxSpeed\">\nCTD_MaxDistConsecutiveAxles / Maximum permitted distance between two consecutive axles in case of TSI non-compliance" },
        { "role": "assistant", "content": "SHACL shapes not found" },

        { "role": "system", "content": "## TASK" },
        { "role": "user", "content": "5. Generate SHACL restrictions for the following property: {entity}." },
        
        { "role": "user", "content": "## Ontology:" },
        { "role": "user", "content": "{ontology_info}" },
    
        { "role": "user", "content": "## RAG:" },
        { "role": "user", "content": "{rag}" },
    
        { "role": "user", "content": "## Previous SHACL shapes:" },
        { "role": "user", "content": "{shacl_history}" }
    ],

    "generator_agent_property_with_error": [
        { "role": "system", "content": "You are an expert in generating SHACL restrictions for properties, from an ontology and RAG of a guide with constraints." },
        { "role": "system", "content": "You will have to generate shacl shapes of a determined property." },
        
        { "role": "system", "content": "## Chain of Thought" },
        { "role": "system", "content": "Let's reason step-by-step to enable the generation of SHACL shapes, even when information is partial or inferred." },
        { "role": "system", "content": "Follow this 6-step reasoning process to favor generation: 1. Analyze the RAG and ontology info, and look for hints to detect SHACL shapes. 2. Extract all the constraints that are explicitly and clearly defined. 3. Try to infer if there are more implied constraints in the information. 4. If some constraints exists, create a PropertyShape. 5. Additionally, if there are constraints related to the appliccability of the shape, create a SPARQLConstraint just below. 6. Only if there are no restrictions (neither explicit nor implicit) and  no grounded clue, pattern, or inference is possible, return 'SHACL shapes not found'." },

        { "role": "system", "content": "You are allowed and encouraged to make reasonable inferences when explicit data is missing, as long as they follow clear patterns observed in the ontology or previous SHACL shapes (e.g., if the datatype is xsd:boolean, use sh:datatype xsd:boolean and sh:maxCount 1). Always justify these decisions using # Source or # Reasoning comments." },
        { "role": "system", "content": "When generating a SHACL shape, start with the PropertyShape: era-sh:(Name of the property) a sh:PropertyShape ;" },
        { "role": "system", "content": "Always include the metadata properties, with clear rules:" },
        { "role": "system", "content": "- **era:affectedClass**: class where the property is applied, from the ontology." },
        { "role": "system", "content": "- **era:affectedProperty**: the full URI of the property under validation." },
        { "role": "system", "content": "- **era:rinfIndex**: include only if explicitly present in the ontology for this property, and match exactly." },
        { "role": "system", "content": "- **era:scope**: default to \"local\" unless there is clear evidence of another scope." },
        { "role": "system", "content": "- **rdfs:comment**: include only if present in the ontology for this property, and match exactly." },
        { "role": "system", "content": "- **sh:message**: user-readable validation message, inferred from previous shapes or patterns." },
        { "role": "system", "content": "- **sh:path**: always the property URI being validated." },
        { "role": "system", "content": "- **sh:severity**: default to sh:Violation unless there is a strong reason to change it." },
        
        { "role": "system", "content": "Then, add the constraint properties identified or inferred. **At least one** of the following must be included:" },
        { "role": "system", "content": "- **sh:class**: It usually appears in the ontology as rdfs:range, so match them exactly. Use when the property value must be an instance of a specific class." },
        { "role": "system", "content": "- **sh:maxCount**: Use only when the property cannot be repeated (in that case, it takes the value of 1)." },
        { "role": "system", "content": "- **sh:minCount**: Use only when the property is mandatory (in that case, it takes the value of 1)." },
        { "role": "system", "content": "- **sh:nodeKind**: Use to specify the RDF node type expected, e.g., sh:IRI for links to other resources." },
        { "role": "system", "content": "- **sh:datatype**: Use when the property is a literal and must conform to a specific datatype (e.g., xsd:string, xsd:boolean)." },
        { "role": "system", "content": "- **sh:in**: Use when the property value must be one of a predefined set of allowed values (Do NOT invent a set of example values, just include it if it is clearly expressed in RAG or ontolgy)." },
        { "role": "system", "content": "- **sh:pattern**: Use when the property value must match a specific regular expression pattern (usually for string literals)." },
        { "role": "system", "content": "- Another properties that you consider appropriate." },

        { "role": "system", "content": "After adding constraints, include SHACL comments (# Source or # Reasoning) justifying the inclusion of each constraint based on the ontology, RAG, or inferred from previous shapes." },
        { "role": "system", "content": "Additionally, if you think it is convenient, you can create another SHACL shape about the applicability of the property. Make this decision based on whether there are any applicability restrictions between the RAG or the ontology." },
        { "role": "system", "content": "In the case that you think it is convenient to create this shape, it start like this: era-sh:(PropertyName + 'Applicability') a sh:SPARQLConstraint ; ." }, 
        { "role": "system", "content": "Only generate a SPARQLConstraint shape if there is a rule of applicability that is explicit or clearly implied, precisely stated, and clearly marked in the RAG or ontology." },
        { "role": "system", "content": "If no such clear rule about applicability is present, do NOT generate a SPARQLConstraint under any circumstances, and just return the PropertyShape." },
        
        { "role": "system", "content": "For the SPARQLConstraint (if available), add the same metadata as the PropertyShape: era:affectedClass, era:affectedProperty, era:scope, sh:message, sh:path, sh:severity. Add era:rinfIndex and rdfs:comment if present." },
        { "role": "system", "content": "Then, add the sh:select query inside triple quotes, using realistic SPARQL for ERA railway infrastructure. The query should identify violating focus nodes with meaningful ERA properties, include relevant FILTER or FILTER NOT EXISTS conditions if data is missing, use DISTINCT, and include rdfs:label when available. Provide proper prefixes and domain-appropriate logic similar to ERA SHACL profiles." },
        { "role": "system", "content": "Finally, return **only** the SHACL Shapes generated. Do not include any extra text or explanation outside of SHACL comments." },
        
        { "role": "system", "content": "## FEW-SHOT EXAMPLES" },
        { "role": "user", "content": "1. Generate SHACL restrictions for the following property: http://data.europa.eu/949/accelerationLevelCrossing\nOntology: | Sujeto | Predicado | Objeto |\n|--------|-----------|--------|\n| http://data.europa.eu/949/accelerationLevelCrossing | http://www.w3.org/1999/02/22-rdf-syntax-ns#type | http://www.w3.org/2002/07/owl#ObjectProperty |\n| http://data.europa.eu/949/accelerationLevelCrossing | http://www.w3.org/1999/02/22-rdf-syntax-ns#type | http://www.w3.org/2002/07/owl#FunctionalProperty |\n| http://data.europa.eu/949/accelerationLevelCrossing | http://www.w3.org/2000/01/rdf-schema#subPropertyOf | http://data.europa.eu/949/healthSafetyAndEnvironmentObjParameter |\n| http://data.europa.eu/949/accelerationLevelCrossing | http://www.w3.org/2000/01/rdf-schema#domain | n51374b5d30644fcc84043940e5f6a841b14 |\n| http://data.europa.eu/949/accelerationLevelCrossing | http://www.w3.org/2000/01/rdf-schema#range | http://data.europa.eu/949/Document |\n| http://data.europa.eu/949/accelerationLevelCrossing | http://data.europa.eu/949/XMLName | IHS_AccelerationLevelCrossing |\n| http://data.europa.eu/949/accelerationLevelCrossing | http://data.europa.eu/949/applicable | Y/N |\n| http://data.europa.eu/949/accelerationLevelCrossing | http://data.europa.eu/949/dependencyNote | Mandatory value when the level crossing is defined |\n| http://data.europa.eu/949/accelerationLevelCrossing | http://data.europa.eu/949/legalDeadline | In accordance with Implementing Decision 2014/880/EU and by 16 March 2019 at the latest |\n| http://data.europa.eu/949/accelerationLevelCrossing | http://data.europa.eu/949/rinfIndex | 1.1.1.1.7.3 |\n| http://data.europa.eu/949/accelerationLevelCrossing | http://data.europa.eu/949/shaclShapeValidationRule | http://data.europa.eu/949/shapes/AccelerationLevelCrossing |\n| http://data.europa.eu/949/accelerationLevelCrossing | http://data.europa.eu/949/shaclShapeValidationRule | http://data.europa.eu/949/shapes/AccelerationLevelCrossingApplicability |\n| http://data.europa.eu/949/accelerationLevelCrossing | http://purl.org/dc/terms/created | 2021-08-03 |\n| http://data.europa.eu/949/accelerationLevelCrossing | http://purl.org/dc/terms/modified | 2024-01-08 |\n| http://data.europa.eu/949/accelerationLevelCrossing | http://purl.org/dc/terms/modified | 2024-11-20 |\n| http://data.europa.eu/949/accelerationLevelCrossing | http://www.w3.org/2000/01/rdf-schema#comment | Existence of limit for acceleration of train if stopping or recovering speed close to a level crossing expressed in a specific reference acceleration curve. |\n\nRAG:\n<table><tr><td>Number</td><td>1.1.1.1.7.3</td></tr><tr><td>Title</td><td>Acceleration allowed near level crossing</td></tr><tr><td>XML Name</td><td>SOL\n Track Parameter IHS_AccelerationLevelCrossing</td></tr><tr><td>Definition</td><td>Existence of\n limit for acceleration of train if stopping or recovering speed close to a level\n crossing expressed in a specific reference acceleration curve in metres\n per square second.</td></tr><tr><td>Applicable</td><td>Y/N/NYA</td></tr><tr><td>Explanation on applicability: Applicable\n only when selected value of parameter 1.1.1.1.7.2 is ‘Y’</td></tr><tr><td>Can be\n repeated</td><td>N Use\n this ability if you have more than one document</td></tr><tr><td>Data\n presentation</td><td>Characterstring allows the previous [N.N] which ensures the backward compatibility</td></tr><tr><td>Explanation on data presentation:</td></tr><tr><td/><td>The reference of the document defining the limit shall be provided in the\n characterstring and the document send to the Agency by the NRE. Acceleration shall be presented with precision of 0.1 m/s 2 .\n If there is no national rules or no limits defined, the value should be [0.0] per\n default.</td></tr><tr><td>Explanation</td><td>The document\n itself has to be upload by the NRE via the “reference document management”\n functionality. The reference of the document is provided for the parameter using the characterstring format.</td></tr></table>\n\n<table><tr><td>Number</td><td>1.1.1.1.7.2</td></tr><tr><td>Title</td><td>Existence of level crossings</td></tr><tr><td>XML Name</td><td>SOL\n Track Parameter IHS_LevelCrossing</td></tr><tr><td>Definition</td><td>Indication whether level crossings (including pedestrian track crossing) exist on the section of line.</td></tr><tr><td>Applicable</td><td>Y/NYA</td></tr><tr><td>Can be\n repeated</td><td>N</td></tr><tr><td>Data\n presentation</td><td>Single\n selection from the predefined list: Y\n N</td></tr><tr><td>General\n explanation</td><td>Parameter concerns the level crossing of the railway with a road or a street.</td></tr></table>\n\n1.1.1.1.7.3 IHS_AccelerationLevelCrossing / Acceleration allowed at level crossing 1.1.1.1.7.4 IHS_HABDExist /Existence of trackside hot axle box detector (HABD) 1.1.1.1.7.5 IHS_TSIHABD/Trackside HABD TSI compliant\n\n<table><tr><td>Number</td><td>1.1.1.1.6.1</td></tr><tr><td>Title</td><td>Maximum train deceleration</td></tr><tr><td>XML Name</td><td>SOL\n Track Parameter ILR_MaxDeceleration</td></tr><tr><td>Definition</td><td>Limit for longitudinal track resistance given as a maximum allowed train deceleration and expressed in metres per square second.</td></tr><tr><td>Applicable</td><td>Y/N/NYA</td></tr><tr><td>Explanation on applicability: ‘N’ shall\n be selected when specific track is part of a line which is not in the scope of\n the TSI.</td></tr><tr><td>Can be\n repeated</td><td>N</td></tr><tr><td>Data\n presentation</td><td>[N.N]</td></tr><tr><td>General Explanation</td><td>New lines\n are assumed to be compliant with the TSI INF. For TSI\n compliant lines the default value of 2.5 m/s 2 shall be\n presented. If for the design of the track the braking forces were assumed on basis of the\n deceleration lower value than 2.5 m/s 2 , the applied value\n of the deceleration has to be specified.</td></tr><tr><td>References</td><td>INF TSI:\n 4.2.6 HS INF TSI: 4.2.13 CR INF TSI: 4.2.7</td></tr></table>" },
        { "role": "assistant", "content": "era-sh:AccelerationLevelCrossing a sh:PropertyShape ; era:affectedClass era:RunningTrack ; era:affectedProperty era:accelerationLevelCrossing ; era:rinfIndex \"1.1.1.1.7.3\" ; era:scope \"local\" ; rdfs:comment \"Existence of limit for acceleration of train if stopping or recovering speed close to a level crossing expressed in a specific reference acceleration curve.\"@en ; sh:class era:Document ; # Source: ontology range is http://data.europa.eu/949/Document sh:maxCount 1 ; # Source: ontology declares owl:FunctionalProperty so only one value is allowed sh:message \"accelerationLevelCrossing (1.1.1.1.7.3): The track or subset with common characteristics must have at most one acceleration level crossing value that is a Document. This error may be due to having more than one value or having a value that is not an instance of Document.\"@en ; sh:nodeKind sh:IRI ; # Source: RAG scope note indicates document reference in IRI form sh:path era:accelerationLevelCrossing ; sh:severity sh:Violation . era-sh:AccelerationLevelCrossingApplicability a sh:SPARQLConstraint ; era:affectedClass era:RunningTrack ; era:affectedProperty era:accelerationLevelCrossing ; era:rinfIndex \"1.1.1.1.7.3\" ; era:scope \"local\" ; rdfs:comment \"Existence of limit for acceleration of train if stopping or recovering speed close to a level crossing expressed in a specific reference acceleration curve.\"@en ; sh:message \"accelerationLevelCrossing (1.1.1.1.7.3): This error is due to the track or subset with common characteristics {{?trackLabel}}, violating the rule: Applicable only when selected value of parameter 1.1.1.1.7.2 is ‘Y’\"@en ; sh:prefixes era: ; sh:select \"\"\" PREFIX era: <http://data.europa.eu/949/> PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#> PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> SELECT DISTINCT $this ?trackLabel WHERE {{ $this rdfs:label ?trackLabel . FILTER EXISTS {{ $this era:hasLevelCrossings ?value }} . # Source: RAG rule states applicable only when 1.1.1.1.7.2 is Y FILTER NOT EXISTS {{ $this era:accelerationLevelCrossing ?value }} . }} \"\"\" ; sh:severity sh:Violation ." },
        { "role": "user", "content": "2. Generate SHACL restrictions for the following property: http://data.europa.eu/949/highSpeedLoadModelCompliance\nOntology:\n| Sujeto | Predicado | Objeto |\n|--------|-----------|--------|\n| http://data.europa.eu/949/highSpeedLoadModelCompliance | http://www.w3.org/1999/02/22-rdf-syntax-ns#type | http://www.w3.org/2002/07/owl#DatatypeProperty |\n| http://data.europa.eu/949/highSpeedLoadModelCompliance | http://www.w3.org/1999/02/22-rdf-syntax-ns#type | http://www.w3.org/2002/07/owl#FunctionalProperty |\n| http://data.europa.eu/949/highSpeedLoadModelCompliance | http://www.w3.org/2000/01/rdf-schema#subPropertyOf | http://data.europa.eu/949/performanceDataParameter |\n| http://data.europa.eu/949/highSpeedLoadModelCompliance | http://www.w3.org/2000/01/rdf-schema#domain | n679e4b9ad9264247ae3c967d32719a04b442 |\n\nRAG:\nNumber: 1.1.1.1.2.4.2\nTitle: Compliance of structures with the High Speed Load Model (HSLM)\nXML Name: SOL Track Parameter IPP_HSLMCompliant\nDefinition: For sections of line with a maximum permitted speed of 200km/h or more information regarding the procedure to be used to perform the dynamic compatibility check\nExplanation on definition:\nApplicable: Y/N/NYA Y if the maximum permitted speed of the running track is more than 200km/h and the structures within the section of line are all compatible with the High Speed Load Model (HSLM); information regarding the procedure to be used to perform the dynamic compatibility check shall be provided as well\nCan be repeated: N\nData presentation: Single selection from the predefined list: Y/N\nGeneral explanation:\nExample:\nReferences: Annex D1 OPE TSI 4.2.7.1.2(2) of Regulation No 1299/2014 TSI INF HSLM is defined in EN 1991-2:2003/AC:2010 paragraphs 6.4.6.1.1 (3) to (6) inclusive\n\nIPP_HSLMCompliant/Compliance of structures with the High Speed Load Model (HSLM) dynamic load model\n\nNumber: 1.1.1.1.8.8.1\nTitle: compliance of the tunnel with INF TSI\nXML Name: SOL Tunnel Parameter ITU_TSITunnel\nDefinition: compliance of the tunnel with INF TSI at the maximum permitted speed\nApplicable: Y/N/NYA Y if the speed of the line is equal or greater than 200km/h\nCan be repeated: N\nData presentation: Single selection from the predefined list: Y/N\nExplanation on data presentation:\nReference: clause 4.2.10.1 of INF TSI on Maximum pressure variations in tunnels\n\nParameter 1.1.1.1.2.4.2 – is the naming “Compliance of structures with the (HSLM)” correct? NO (the naming I had was “Compliance of structures with the High Speed Load Model (HSLM) dynamic load model”) corrected in the guide" },
        { "role": "assistant", "content": "era-sh:HighSpeedLoadModelCompliance a sh:PropertyShape ;\n    era:affectedClass era:RunningTrack ;\n    era:affectedProperty era:highSpeedLoadModelCompliance ;\n    era:rinfIndex \"1.1.1.1.2.4.2\" ;\n    era:scope \"local\" ;\n    rdfs:comment \"For sections of line with a maximum permitted speed of 200km/h or more information regarding the procedure to be used to perform the dynamic compatibility check.\"@en ,\n                 \"National classification for load capability\"@en ;\n\n    sh:datatype xsd:boolean ;\n    # Source: ontology range is xsd:boolean (http://www.w3.org/2001/XMLSchema#boolean)\n\n    sh:maxCount 1 ;\n    # Source: ontology declares owl:FunctionalProperty, indicating only one value allowed\n\n    sh:message \"highSpeedLoadModelCompliance (1.1.1.1.2.4.2): The track or subset with common characteristics must have at most one high speed load model compliance value that must be Y/N (boolean). This error may be due to the track having more than one value or having a value of high speed load model compliance that is not Y/N.\"@en ;\n    # Source: RAG – 'Can be repeated: N' and 'Data presentation: Y/N'\n\n    sh:path era:highSpeedLoadModelCompliance ;\n\n    sh:severity sh:Violation .\n\nera-sh:HighSpeedLoadModelComplianceApplicability a sh:SPARQLConstraint ;\n    era:affectedClass era:RunningTrack ;\n    era:affectedProperty era:highSpeedLoadModelCompliance ;\n    era:rinfIndex \"1.1.1.1.2.4.2\" ;\n    era:scope \"local\" ;\n    rdfs:comment \"Applicable if the maximum permitted speed of the running track is more than 200km/h and the structures within the section of line are all compatible with the High Speed Load Model (HSLM); information regarding the procedure to be used to perform the dynamic compatibility check shall be provided as well.\"@en ;\n    # Source: scopeNote and Annex D1 OPE TSI (INF TSI 4.2.7.1.2(2))\n\n    sh:message \"highSpeedLoadModelCompliance (1.1.1.1.2.4.2): This error is due to the track or subset with common characteristics {{?trackLabel}}, violating the rule: Applicable only if the maximum permitted speed is greater than 200 km/h.\"@en ;\n\n    sh:prefixes era: ;\n\n    sh:select \"\"\"\n    PREFIX era: <http://data.europa.eu/949/>\n    PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\n    SELECT DISTINCT $this ?trackLabel WHERE {{\n        $this rdfs:label ?trackLabel .\n        $this era:maximumPermittedSpeed ?speed .\n        FILTER(xsd:integer(?speed) <= 200) .\n        FILTER EXISTS {{ $this era:highSpeedLoadModelCompliance ?value }} .\n    }}\n    \"\"\" ;\n    sh:severity sh:Violation ." },
        { "role": "user", "content": "3. Generate SHACL restrictions for the following property: http://data.europa.eu/949/hasPart\nOntology:\n| Sujeto | Predicado | Objeto |\n|--------|-----------|--------|\n| http://data.europa.eu/949/hasPart | http://www.w3.org/1999/02/22-rdf-syntax-ns#type | http://www.w3.org/2002/07/owl#ObjectProperty |\n| http://data.europa.eu/949/hasPart | http://www.w3.org/1999/02/22-rdf-syntax-ns#type | http://www.w3.org/2002/07/owl#IrreflexiveProperty |\n| http://data.europa.eu/949/hasPart | http://www.w3.org/2002/07/owl#inverseOf | http://data.europa.eu/949/isPartOf |\n| http://data.europa.eu/949/hasPart | http://www.w3.org/2000/01/rdf-schema#domain | http://data.europa.eu/949/InfrastructureElement |\n| http://data.europa.eu/949/hasPart | http://www.w3.org/2000/01/rdf-schema#range | http://data.europa.eu/949/InfrastructureElement |\n| http://data.europa.eu/949/hasPart | http://data.europa.eu/949/shaclShapeValidationRule | http://data.europa.eu/949/shapes/HasPart |\n| http://data.europa.eu/949/hasPart | http://data.europa.eu/949/shaclShapeValidationRule | http://data.europa.eu/949/shapes/HasPartOP |\n| http://data.europa.eu/949/hasPart | http://purl.org/dc/terms/created | 2024-05-24 |\n| http://data.europa.eu/949/hasPart | http://purl.org/dc/terms/modified | 2025-01-30 |\n| http://data.europa.eu/949/hasPart | http://purl.org/dc/terms/modified | 2025-02-18 |\n| http://data.europa.eu/949/hasPart | http://purl.org/dc/terms/replaces | http://data.europa.eu/949/siding |\n| http://data.europa.eu/949/hasPart | http://purl.org/dc/terms/replaces | http://data.europa.eu/949/track |\n| http://data.europa.eu/949/hasPart | http://www.w3.org/2000/01/rdf-schema#comment | Indicates that an infrastructure element is composed of one or more other (distinct) infrastructure elements. This property is used to represent part-whole relationships between infrastructure elements. An element cannot be a part of itself. |\n| http://data.europa.eu/949/hasPart | http://www.w3.org/2000/01/rdf-schema#isDefinedBy | http://data.europa.eu/949/ |\n| http://data.europa.eu/949/hasPart | http://www.w3.org/2000/01/rdf-schema#label | has part |\n\nRAG:\n1.2.2.0.4.5 ITS_SandRestocking / Existence of sand restocking 1.2.2.0.4.6 ITS_ElectricShoreSupply / Existence of electric shore supply\nFig. 1 – Levels of description of the network (adapted from UIC RailTopoModel Railway Network\nRelations between parameters 36\nRelations between parameters" },
        { "role": "assistant", "content": "era-sh:HasPart a sh:PropertyShape ;\n    era:affectedClass era:InfrastructureElement ;\n    era:affectedProperty era:hasPart ;\n    era:scope \"local\" ;\n\n    rdfs:comment \"Indicates that an infrastructure element is composed of one or more other (distinct) infrastructure elements. This property is used to represent part-whole relationships between infrastructure elements. An element cannot be a part of itself.\"@en ;\n    # Source: rdfs:comment in ontology definition of hasPart\n\n    sh:class era:InfrastructureElement ;\n    # Source: ontology range is era:InfrastructureElement (rdfs:range)\n\n    sh:minCount 1 ;\n    # Inferred: expected at least one part to model part-whole structure. Not explicitly in ontology but derived from semantics and usage in structural hierarchy (e.g., Fig. 1 – UIC RailTopoModel)\n\n    sh:nodeKind sh:IRI ;\n    # Implied: links must refer to other identifiable infrastructure elements (IRI references)\n\n    sh:message \"hasPart: The InfrastructureElement must have a hasPart reference that is an IRI that refers to an instance of InfrastructureElement. This error is due to not having a value or having a value that is not an instance of InfrastructureElement.\"@en ;\n\n    sh:path era:hasPart ;\n\n    sh:severity sh:Violation .\n\nera-sh:HasPartIrreflexivity a sh:SPARQLConstraint ;\n    era:affectedClass era:InfrastructureElement ;\n    era:affectedProperty era:hasPart ;\n    era:scope \"local\" ;\n\n    rdfs:comment \"Enforces irreflexivity of hasPart: an element cannot be a part of itself.\"@en ;\n    # Source: ontology declares owl:IrreflexiveProperty\n\n    sh:message \"hasPart: The InfrastructureElement {{?thisLabel}} cannot have itself as part.\"@en ;\n\n    sh:prefixes era: ;\n\n    sh:select \"\"\"\n    PREFIX era: <http://data.europa.eu/949/>\n    PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\n    SELECT DISTINCT $this ?thisLabel WHERE {{\n        $this rdfs:label ?thisLabel .\n        FILTER EXISTS {{ $this era:hasPart $this }} .\n    }}\n    \"\"\" ;\n\n    sh:severity sh:Violation ." },
        { "role": "user", "content": "4. Generate SHACL restrictions for the following property: http://data.europa.eu/949/vehicleTypeMaximumSpeed\nOntology:\n| Sujeto | Predicado | Objeto |\n|--------|-----------|--------|\n| http://data.europa.eu/949/vehicleTypeMaximumSpeed | http://www.w3.org/1999/02/22-rdf-syntax-ns#type | http://www.w3.org/2002/07/owl#DatatypeProperty |\n| http://data.europa.eu/949/vehicleTypeMaximumSpeed | http://www.w3.org/2000/01/rdf-schema#subPropertyOf | http://data.europa.eu/949/vehicleTypeTechnicalDataCharacteristic |\n| http://data.europa.eu/949/vehicleTypeMaximumSpeed | http://www.w3.org/2000/01/rdf-schema#domain | http://data.europa.eu/949/MaximumSpeedAndCantDeficiency |\n| http://data.europa.eu/949/vehicleTypeMaximumSpeed | http://www.w3.org/2000/01/rdf-schema#range | http://www.w3.org/2001/XMLSchema#integer |\n| http://data.europa.eu/949/vehicleTypeMaximumSpeed | http://data.europa.eu/949/eratvIndex | 4.6.4 |\n| http://data.europa.eu/949/vehicleTypeMaximumSpeed | http://purl.org/dc/terms/created | 2023-04-05 |\n| http://data.europa.eu/949/vehicleTypeMaximumSpeed | http://purl.org/dc/terms/modified | 2025-02-18 |\n| http://data.europa.eu/949/vehicleTypeMaximumSpeed | http://purl.org/dc/terms/replaces | http://data.europa.eu/949/maximumSpeedAndCantDeficiency |\n| http://data.europa.eu/949/vehicleTypeMaximumSpeed | http://www.w3.org/2000/01/rdf-schema#comment | Part of the combination of maximum speed and maximum cant deficiency for which the vehicle was assessed. Corresponds to the maximum speed. |\n| http://data.europa.eu/949/vehicleTypeMaximumSpeed | http://www.w3.org/2000/01/rdf-schema#isDefinedBy | http://data.europa.eu/949/ |\n| http://data.europa.eu/949/vehicleTypeMaximumSpeed | http://www.w3.org/2000/01/rdf-schema#label | Vehicle type maximum speed |\n| http://data.europa.eu/949/vehicleTypeMaximumSpeed | http://www.w3.org/2003/06/sw-vocab-status/ns#term_status | stable |\n\nRAG:\n<table><tr><td>Number</td><td>1.1.1.1.4.2</td></tr><tr><td>Title</td><td>Cant<br/> deficiency</td></tr><tr><td>XML Name</td><td>SOL<br/> Track Parameter ITP_CantDeficiency</td></tr><tr><td>Definition</td><td>Maximum cant deficiency expressed in millimetres defined as difference between the applied cant and a higher equilibrium cant the line has been designed for</td></tr><tr><td>Applicable</td><td>Y/NYA</td></tr><tr><td>Can be<br/> repeated</td><td>N</td></tr><tr><td>Data<br/> presentation</td><td>[+/-] [NNN]</td></tr><tr><td>Explanations on data presentation: In<br/> case of positive value of cant deficiency or zero symbol ‘+’ shall be applied. In<br/> case of negative cant deficiency symbol ‘-‘ has to be selected. Value of the cant<br/> deficiency shall be given in millimetres. In case of lateral uncompensated<br/> acceleration on a 1435 mm track gauge of 1.0 m/s 2 the value<br/> of 153 mm may be published.</td></tr><tr><td>References</td><td>INF<br/> TSI: 4.2.4.3 HS INF TSI: 4.2.8 CR INF TSI: 4.2.5.4</td></tr></table>\n<table><tr><td>Number</td><td>1.1.1.1.2.5</td></tr><tr><td>Title</td><td>Maximum permitted speed</td></tr><tr><td>XML Name</td><td>SOL<br/> Track Parameter IPP_MaxSpeed</td></tr><tr><td>Definition</td><td>Nominal maximum operational speed on the line as a result of INF, ENE and CCS subsystem characteristics expressed in kilometres/hour.</td></tr><tr><td>Explanation on definition</td><td>‘Speed on the line’ shall be understood as speed on the track of the section of line<br/> in question.</td></tr><tr><td>Applicable</td><td>Y/NYA</td></tr><tr><td>Can be<br/> repeated</td><td>N</td></tr><tr><td>Data<br/> presentation</td><td>[NNN]</td></tr><tr><td>Limit values</td><td>min=0, max=500</td></tr><tr><td>References</td><td>INF<br/> TSI: All HS and<br/> CR TSIs (ENE, CCS)</td></tr><tr><td>Example</td><td>When INF<br/> allows 160 km/h, ENE allows 100 km/h and CCS allows 120 km/h, the max permitted<br/> speed on this track of this section of line is 100 km/h. When for<br/> freight trains operation the maximum permitted speed is 100 km/h, and for passenger<br/> trains it is 160 km/h, as the value of maximum permitted speed shall be presented<br/> 160 km/h only.</td></tr></table>\n<SOLTrackParameter Value=\"351\" IsApplicable=\"Y\" ID=\"IPP_MaxSpeed\">\nCTD_MaxDistConsecutiveAxles / Maximum permitted distance between two consecutive axles in case of TSI non-compliance" },
        { "role": "assistant", "content": "SHACL shapes not found" },

        { "role": "system", "content": "## TASK" },
        { "role": "user", "content": "5. Generate SHACL restrictions for the following property: {entity}." },
        { "role": "user", "content": "The last generated this SHACL constraint contained the following error: {error}. Try to prevent this error from occurring." },
        
        { "role": "user", "content": "## Ontology:" },
        { "role": "user", "content": "{ontology_info}" },
    
        { "role": "user", "content": "## RAG:" },
        { "role": "user", "content": "{rag}" },
    
        { "role": "user", "content": "## Previous SHACL shapes:" },
        { "role": "user", "content": "{shacl_history}" }
    ]
}

