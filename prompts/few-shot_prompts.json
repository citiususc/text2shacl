{
    "evaluator_agent": [
        { "role": "system", "content": "You are an expert evaluator in RDF graph validation using SHACL. Your task is to determine whether the current information about a class or property is sufficient to generate SHACL constraints."},
        { "role": "user", "content": "Based on the following information from the ontology and RAG, is it enough to write SHACL restrictions for this class/property?"},
        { "role": "user", "content": "Evaluate if the current information is sufficient. If it is, respond only with 'yes'. If not, provide a list of the entities (classes or properties) that are related to the class/property '{entity}' and are needed from the ontology to complete the SHACL restrictions."},
        { "role": "user", "content": "The extra information must be a class or a property from the ontology. The response should be in a similar format to this example: [class_or_property_needed_from_the_ontology_1, class_or_property_needed_from_the_ontology_2, ...]. Respond with a JSON-style list of the actual URIs (not placeholders) of ontology classes or properties needed. Do not include dummy names like 'class_or_property_needed_from_the_ontology_1'"},
        { "role": "user", "content": "Your response must be either: 'yes' — or — a list of valid ontology URIs. Do not return anything else."},
        { "role": "user", "content": "Ontology info of important subjects:"},
        { "role": "user", "content": "{ontology}"},
        { "role": "user", "content": "RAG:"},
        { "role": "user", "content": "{rag}"}
    ],
    "generator_agent_property": [
        { "role": "system", "content": "You are an expert in generating SHACL restrictions for ObjectProperties and DataTypeProperties, using ontology and RAG context. You must strictly follow the evidence in the RAG or ontology to determine the constraints." },
        
        { "role": "system", "content": "## CONDITIONS OF GENERATION" },
        { "role": "system", "content": "1. Only generate SHACL shapes if you clearly identify constraints for the property in the Ontology or the RAG context. Do NOT guess or invent constraints." },
        { "role": "system", "content": "2. If no SHACL constraints are clearly stated or implied, return exactly this string: 'SHACL shapes not found'." },
        
        { "role": "system", "content": "3. If constraints are found, generate a SHACL PropertyShape starting like this: era-sh:(PropertyName) a sh:PropertyShape ;" },
        { "role": "system", "content": "4. Additionally, generate an applicability SPARQLConstraint Shape starting like this: era-sh:(PropertyName + 'Applicability') a sh:SPARQLConstraint ; if you find explicit applicability rules in the RAG or ontology." },
      
        { "role": "system", "content": "5. Each SHACL shape (PropertyShape or SPARQLConstraint) must include these fields when supported by the data:\n- era:affectedClass\n- era:affectedProperty\n- era:scope (default: local)\n- sh:path\n- sh:message\n- sh:severity (default: sh:Violation)." },
        { "role": "system", "content": "6. PropertyShapes must also include **at least** a field such as:\n- era:rinfIndex\n- rdfs:comment\n- sh:maxCount\n- sh:nodeKind sh:IRI\n- sh:class\n- sh:minCount\n- sh:datatype\n- sh:in\n- sh:pattern\n- sh:hasValue..." },
        { "role": "system", "content": "7. SPARQLConstraint shapes must also include **sh:select** with a valid SPARQL query." },

        { "role": "system", "content": "8. Use only URIs and terms present in the ontology. Do NOT fabricate URIs. Do not add example comments or placeholders." },
        { "role": "system", "content": "9. Respond only with the new SHACL restrictions in .ttl format. No explanations, no prefixes, no text before or after." },
      
        { "role": "system", "content": "## FEW-SHOT EXAMPLES" },
        { "role": "user", "content": "1. Generate SHACL restrictions for the following property: era:EtcsInfillLineAccess Ontology: | Sujeto | Predicado | Objeto | | http://data.europa.eu/949/etcsInfillLineAccess | http://www.w3.org/1999/02/22-rdf-syntax-ns#type | http://www.w3.org/2002/07/owl#DatatypeProperty | http://data.europa.eu/949/etcsInfillLineAccess | http://www.w3.org/1999/02/22-rdf-syntax-ns#type | http://www.w3.org/2002/07/owl#FunctionalProperty | http://data.europa.eu/949/etcsInfillLineAccess | http://www.w3.org/2000/01/rdf-schema#subPropertyOf | http://data.europa.eu/949/tsiCompliantTrainProtectionSystemDataParameter | http://data.europa.eu/949/etcsInfillLineAccess | http://www.w3.org/2000/01/rdf-schema#domain | nf6272deb04bb4e7fba07ae28374f1904b352 | http://data.europa.eu/949/etcsInfillLineAccess | http://www.w3.org/2000/01/rdf-schema#range | http://www.w3.org/2001/XMLSchema#boolean | http://data.europa.eu/949/etcsInfillLineAccess | http://data.europa.eu/949/XMLName | CPE_Infill | http://data.europa.eu/949/etcsInfillLineAccess | http://data.europa.eu/949/applicable | Y/N/NYA | http://data.europa.eu/949/etcsInfillLineAccess | http://data.europa.eu/949/dependencyNote | A value has to be provided when ETCS is present (a value is provided on 1.1.1.3.2.1) and the ETCS level is 1. | http://data.europa.eu/949/etcsInfillLineAccess | http://data.europa.eu/949/legalDeadline | 12 months after publication of Article 7 Guide for OP tracks | http://data.europa.eu/949/etcsInfillLineAccess | http://data.europa.eu/949/legalDeadline | In accordance with Implementing Decision 2014/880/EU and by 16 March 2019 at the latest | http://data.europa.eu/949/etcsInfillLineAccess | http://data.europa.eu/949/rinfIndex | 1.1.1.3.2.3 | http://data.europa.eu/949/etcsInfillLineAccess | http://data.europa.eu/949/rinfIndex | 1.2.1.1.1.3 | http://data.europa.eu/949/etcsInfillLineAccess | http://data.europa.eu/949/shaclShapeValidationRule | http://data.europa.eu/949/shapes/EtcsInfillLineAccess | http://data.europa.eu/949/etcsInfillLineAccess | http://data.europa.eu/949/shaclShapeValidationRule | http://data.europa.eu/949/shapes/EtcsInfillLineAccessApplicability | http://data.europa.eu/949/etcsInfillLineAccess | http://purl.org/dc/terms/created | 2021-08-08 | http://data.europa.eu/949/etcsInfillLineAccess | http://purl.org/dc/terms/modified | 2021-09-12 | http://data.europa.eu/949/etcsInfillLineAccess | http://purl.org/dc/terms/modified | 2025-02-28 | http://data.europa.eu/949/etcsInfillLineAccess | http://purl.org/dc/terms/modified | 2025-03-04 | http://data.europa.eu/949/etcsInfillLineAccess | http://purl.org/dc/terms/relation | http://data.europa.eu/949/etcsLevelType | http://data.europa.eu/949/etcsInfillLineAccess | http://purl.org/dc/terms/source | http://data.europa.eu/eli/reg_impl/2023/1695/oj | http://data.europa.eu/949/etcsInfillLineAccess | http://www.w3.org/2000/01/rdf-schema#comment | Indication whether infill is required to access the line for safety reasons. | http://data.europa.eu/949/etcsInfillLineAccess | http://www.w3.org/2000/01/rdf-schema#isDefinedBy | http://data.europa.eu/949/ | http://data.europa.eu/949/etcsInfillLineAccess | http://www.w3.org/2000/01/rdf-schema#label | ETCS infill necessary for line access | http://data.europa.eu/949/etcsInfillLineAccess | http://www.w3.org/2003/06/sw-vocab-status/ns#term_status | stable | http://data.europa.eu/949/etcsInfillLineAccess | http://www.w3.org/2004/02/skos/core#scopeNote | As indicated in CCS TSI section 7.2.9.1, an ETCS Level 1 trackside application may require that the on-board is equipped with the corresponding in-fill data transmission (Euroloop or radio) if the release speed is set to zero for safety reasons. See: TSI CCS 7.2.9.1 & 4.2.3 | RAG: <table><tr><td>Number</td><td>1.1.1.3.2.3</td></tr><tr><td>Title</td><td>ETCS<br/> infill necessary for line access</td></tr><tr><td>XML Name</td><td>SOL<br/> Track Parameter CPE_Infill</td></tr><tr><td>Definition</td><td>Indication whether infill is required to access the line for safety reasons.</td></tr><tr><td>Explanation on definition</td><td>Infill is the criterion for a vehicle to get access to the network .line.</td></tr><tr><td>Applicable</td><td>Y/N/NYA</td></tr><tr><td>Explanation on applicability: Only<br/> applicable when selected value for 1.1.1.3.2.1 is \u20181\u2019.</td></tr><tr><td>Can be<br/> repeated</td><td>N</td></tr><tr><td>Data<br/> presentation</td><td>Single selection from the predefined list: Y / N</td></tr><tr><td>General<br/> Explanations</td><td>As<br/> indicated in CCS TSI section 7.2.6 an ETCS Level 1 trackside application may require<br/> that the on-board is equipped with the corresponding in-fill data transmission<br/> (Euroloop or radio) if the release speed is set to zero for safety reasons.</td></tr><tr><td>Reference</td><td>CCS<br/> TSI: 7.2.6 and 4.2.3</td></tr></table> 1.1.1.3.2.3 CPE_Infill / ETCS infill necessary for line access 1.1.1.3.2.4 CPE_InfillLineSide / ETCS infill installed lineside <table><tr><td>Number</td><td>1.1.1.3.2.4</td></tr><tr><td>Title</td><td>ETCS<br/> infill installed line-side</td></tr><tr><td>XML Name</td><td>SOL<br/> Track Parameter CPE_InfillLineSide</td></tr><tr><td>Definition</td><td>Information about installed trackside equipment capable to transmit infill<br/> information by loop or GSM-R for level 1 installation.</td></tr><tr><td>Applicable</td><td>Y/N/NYA</td></tr><tr><td>Explanation on applicability: Only<br/> applicable when selected value for 1.1.1.3.2.1 is \u20181\u2019.</td></tr><tr><td>Can be<br/> repeated</td><td>N</td></tr><tr><td>Data<br/> presentation</td><td>Single<br/> choice from the predefined list: None Loop GSM-R radio infill Loop &amp;<br/> GSM-R radio infill</td></tr><tr><td>Reference</td><td>CCS<br/> TSI: 4.2.2</td></tr></table> [9] Line under construction" },
        { "role": "assistant", "content": "era-sh:EtcsInfillLineAccess a sh:PropertyShape ; era:affectedClass era:RunningTrack ; era:affectedProperty era:etcsInfillLineAccess ; era:rinfIndex \"1.1.1.3.2.3\", \"1.2.1.1.1.3\" ; era:scope \"local\" ; rdfs:comment \"Indication whether infill is required to access the line for safety reasons.\"@en ; sh:datatype xsd:boolean ; sh:maxCount 1 ; sh:message \"etcsInfillLineAccess (1.1.1.3.2.3, 1.2.1.1.1.3): Each track or subset with common characteristics may define the existence of a ETCS infill necessary for line access. This error is due to having more than one indication of ETCS infill necessary for line access value or having an indication of ETCS infill necessary for line access value that is not Y/N (boolean).\"@en ; sh:path era:etcsInfillLineAccess ; sh:severity sh:Violation . era-sh:EtcsInfillLineAccessApplicability a sh:SPARQLConstraint ; era:affectedClass era:RunningTrack ; era:affectedProperty era:etcsInfillLineAccess ; era:rinfIndex \"1.1.1.3.2.3\", \"1.2.1.1.1.3\" ; era:scope \"local\" ; rdfs:comment \"Only applicable when selected value for 1.1.1.3.2.1 (ETCS present).\"@en ; sh:message \"etcsInfillLineAccess (1.1.1.3.2.3, 1.2.1.1.1.3):The track or subset with common characteristics {{$this}} ({{?label}}), has a 'ETCS Level Type' defined which makes the etcsInfillLineAccess parameter applicable. This error is due to {{$this}} not having a value for such a parameter.\"@en ; sh:prefixes era: ; sh:select \"\"\" PREFIX era: <http://data.europa.eu/949/> PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#> SELECT DISTINCT $this ?label WHERE {{ $this era:etcs ?etcs. ?etcs era:etcsLevelType ?etcsType. OPTIONAL{{$this rdfs:label ?label}} . FILTER NOT EXISTS {{$this era:etcsInfillLineAccess ?value}} . }} \"\"\" ; sh:severity sh:Violation .        " },
        { "role": "user", "content": "2. Generate SHACL restrictions for the following property: era:HasPlatformCurvature Ontology: <http://data.europa.eu/949/etcsInfillLineAccess> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www.w3.org/2002/07/owl#DatatypeProperty> . <http://data.europa.eu/949/etcsInfillLineAccess> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www.w3.org/2002/07/owl#FunctionalProperty> . <http://data.europa.eu/949/etcsInfillLineAccess> <http://www.w3.org/2000/01/rdf-schema#subPropertyOf> <http://data.europa.eu/949/tsiCompliantTrainProtectionSystemDataParameter> . <http://data.europa.eu/949/etcsInfillLineAccess> <http://www.w3.org/2000/01/rdf-schema#domain> nf9cd43bdd37242698f864f7a5238ecaeb352 . <http://data.europa.eu/949/etcsInfillLineAccess> <http://www.w3.org/2000/01/rdf-schema#range> <http://www.w3.org/2001/XMLSchema#boolean> . <http://data.europa.eu/949/etcsInfillLineAccess> <http://data.europa.eu/949/XMLName> \"CPE_Infill\" . <http://data.europa.eu/949/etcsInfillLineAccess> <http://data.europa.eu/949/applicable> \"Y/N/NYA\" . <http://data.europa.eu/949/etcsInfillLineAccess> <http://data.europa.eu/949/dependencyNote> \"A value has to be provided when ETCS is present (a value is provided on 1.1.1.3.2.1) and the ETCS level is 1.\" . <http://data.europa.eu/949/etcsInfillLineAccess> <http://data.europa.eu/949/legalDeadline> \"12 months after publication of Article 7 Guide for OP tracks\" . <http://data.europa.eu/949/etcsInfillLineAccess> <http://data.europa.eu/949/legalDeadline> \"In accordance with Implementing Decision 2014/880/EU and by 16 March 2019 at the latest\" . <http://data.europa.eu/949/etcsInfillLineAccess> <http://data.europa.eu/949/rinfIndex> \"1.1.1.3.2.3\" . <http://data.europa.eu/949/etcsInfillLineAccess> <http://data.europa.eu/949/rinfIndex> \"1.2.1.1.1.3\" . <http://data.europa.eu/949/etcsInfillLineAccess> <http://data.europa.eu/949/shaclShapeValidationRule> <http://data.europa.eu/949/shapes/EtcsInfillLineAccess> . <http://data.europa.eu/949/etcsInfillLineAccess> <http://data.europa.eu/949/shaclShapeValidationRule> <http://data.europa.eu/949/shapes/EtcsInfillLineAccessApplicability> . <http://data.europa.eu/949/etcsInfillLineAccess> <http://purl.org/dc/terms/created> \"2021-08-08\" . <http://data.europa.eu/949/etcsInfillLineAccess> <http://purl.org/dc/terms/modified> \"2021-09-12\" . <http://data.europa.eu/949/etcsInfillLineAccess> <http://purl.org/dc/terms/modified> \"2025-02-28\" . <http://data.europa.eu/949/etcsInfillLineAccess> <http://purl.org/dc/terms/modified> \"2025-03-04\" . <http://data.europa.eu/949/etcsInfillLineAccess> <http://purl.org/dc/terms/relation> <http://data.europa.eu/949/etcsLevelType> . <http://data.europa.eu/949/etcsInfillLineAccess> <http://purl.org/dc/terms/source> <http://data.europa.eu/eli/reg_impl/2023/1695/oj> . <http://data.europa.eu/949/etcsInfillLineAccess> <http://www.w3.org/2000/01/rdf-schema#comment> \"Indication whether infill is required to access the line for safety reasons.\" . <http://data.europa.eu/949/etcsInfillLineAccess> <http://www.w3.org/2000/01/rdf-schema#isDefinedBy> <http://data.europa.eu/949/> . <http://data.europa.eu/949/etcsInfillLineAccess> <http://www.w3.org/2000/01/rdf-schema#label> \"ETCS infill necessary for line access\" . <http://data.europa.eu/949/etcsInfillLineAccess> <http://www.w3.org/2003/06/sw-vocab-status/ns#term_status> \"stable\" . <http://data.europa.eu/949/etcsInfillLineAccess> <http://www.w3.org/2004/02/skos/core#scopeNote> \"As indicated in CCS TSI section 7.2.9.1, an ETCS Level 1 trackside application may require that the on-board is equipped with the corresponding in-fill data transmission (Euroloop or radio) if the release speed is set to zero for safety reasons.\" . |  RAG: ILL_MinRadHorzCurve / Minimum radius of horizontal curve 1.2.2.0.3.3 ILL_MinRadVertCurve / Minimum radius of vertical curve ILL_MinRadHorzCurve / Minimum radius of horizontal curve 1.1.1.1.3.7 ILL_MinRadHorzCurve / Minimum radius of horizontal curve ILL_MinRadVertCurve / Minimum radius of vertical curve" },
        { "role": "assistant", "content": "era-sh:HasPlatformCurvature a sh:PropertyShape ; era:affectedClass era:PlatformEdge ; era:affectedProperty era:hasPlatformCurvature ; era:rinfIndex \"1.2.1.0.6.8 \" ; era:scope \"local\" ; rdfs:comment \"Indication of the existence of the curvature of the platform.\"@en ; sh:datatype xsd:boolean ; sh:maxCount 1 ; sh:message \"hasPlatformCurvature (1.2.1.0.6.8): Each Platform must have at most one hasPlatformCurvature value. This error may be caused due to having a platform with multiple hasPlatformCurvature values or having a value that is not a boolean.\"@en ; sh:path era:hasPlatformCurvature ; sh:severity sh:Violation .        " },
        { "role": "user", "content": "3. Generate SHACL restrictions for the following property: era:vehicleTypeMaximumSpeed Ontology: <http://data.europa.eu/949/vehicleTypeMaximumSpeed> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www.w3.org/2002/07/owl#DatatypeProperty> . <http://data.europa.eu/949/vehicleTypeMaximumSpeed> <http://www.w3.org/2000/01/rdf-schema#subPropertyOf> <http://data.europa.eu/949/vehicleTypeTechnicalDataCharacteristic> . <http://data.europa.eu/949/vehicleTypeMaximumSpeed> <http://www.w3.org/2000/01/rdf-schema#domain> <http://data.europa.eu/949/MaximumSpeedAndCantDeficiency> . <http://data.europa.eu/949/vehicleTypeMaximumSpeed> <http://www.w3.org/2000/01/rdf-schema#range> <http://www.w3.org/2001/XMLSchema#integer> . <http://data.europa.eu/949/vehicleTypeMaximumSpeed> <http://data.europa.eu/949/eratvIndex> \"4.6.4\" . <http://data.europa.eu/949/vehicleTypeMaximumSpeed> <http://purl.org/dc/terms/created> \"2023-04-05\" . <http://data.europa.eu/949/vehicleTypeMaximumSpeed> <http://purl.org/dc/terms/modified> \"2025-02-18\" . <http://data.europa.eu/949/vehicleTypeMaximumSpeed> <http://purl.org/dc/terms/replaces> <http://data.europa.eu/949/maximumSpeedAndCantDeficiency> . <http://data.europa.eu/949/vehicleTypeMaximumSpeed> <http://www.w3.org/2000/01/rdf-schema#comment> \"Part of the combination of maximum speed and maximum cant deficiency for which the vehicle was assessed. Corresponds to the maximum speed.\" . <http://data.europa.eu/949/vehicleTypeMaximumSpeed> <http://www.w3.org/2000/01/rdf-schema#isDefinedBy> <http://data.europa.eu/949/> . <http://data.europa.eu/949/vehicleTypeMaximumSpeed> <http://www.w3.org/2000/01/rdf-schema#label> \"Vehicle type maximum speed\" . <http://data.europa.eu/949/vehicleTypeMaximumSpeed> <http://www.w3.org/2003/06/sw-vocab-status/ns#term_status> \"stable\" .  |    RAG: <SOLTrackParameter Value=\"351\" IsApplicable=\"Y\" ID=\"IPP_MaxSpeed\"> <table><tr><td>Number</td><td>1.1.1.1.4.2</td></tr><tr><td>Title</td><td>Cant<br/> deficiency</td></tr><tr><td>XML Name</td><td>SOL<br/> Track Parameter ITP_CantDeficiency</td></tr><tr><td>Definition</td><td>Maximum cant deficiency expressed in millimetres defined as difference between the applied cant and a higher equilibrium cant the line has been designed for</td></tr><tr><td>Applicable</td><td>Y/NYA</td></tr><tr><td>Can be<br/> repeated</td><td>N</td></tr><tr><td>Data<br/> presentation</td><td>[+/-] [NNN]</td></tr><tr><td>Explanations on data presentation: In<br/> case of positive value of cant deficiency or zero symbol \u2018+\u2019 shall be applied. In<br/> case of negative cant deficiency symbol \u2018-\u2018 has to be selected. Value of the cant<br/> deficiency shall be given in millimetres. In case of lateral uncompensated<br/> acceleration on a 1435 mm track gauge of 1.0 m/s 2 the value<br/> of 153 mm may be published.</td></tr><tr><td>References</td><td>INF<br/> TSI: 4.2.4.3 HS INF TSI: 4.2.8 CR INF TSI: 4.2.5.4</td></tr></table> CTD_MaxDistConsecutiveAxles / Maximum permitted distance between two consecutive axles in case of TSI non-compliance <table><tr><td>Number</td><td>1.1.1.1.2.5</td></tr><tr><td>Title</td><td>Maximum permitted speed</td></tr><tr><td>XML Name</td><td>SOL<br/> Track Parameter IPP_MaxSpeed</td></tr><tr><td>Definition</td><td>Nominal maximum operational speed on the line as a result of INF, ENE and CCS subsystem characteristics expressed in kilometres/hour.</td></tr><tr><td>Explanation on definition</td><td>\u2018Speed on the line\u2019 shall be understood as speed on the track of the section of line<br/> in question.</td></tr><tr><td>Applicable</td><td>Y/NYA</td></tr><tr><td>Can be<br/> repeated</td><td>N</td></tr><tr><td>Data<br/> presentation</td><td>[NNN]</td></tr><tr><td>Limit values</td><td>min=0, max=500</td></tr><tr><td>References</td><td>INF<br/> TSI: All HS and<br/> CR TSIs (ENE, CCS)</td></tr><tr><td>Example</td><td>When INF<br/> allows 160 km/h, ENE allows 100 km/h and CCS allows 120 km/h, the max permitted<br/> speed on this track of this section of line is 100 km/h. When for<br/> freight trains operation the maximum permitted speed is 100 km/h, and for passenger<br/> trains it is 160 km/h, as the value of maximum permitted speed shall be presented<br/> 160 km/h only.</td></tr></table>" },
        { "role": "assistant", "content": "SHACL shapes not found" },
        { "role": "user", "content": "Generate SHACL restrictions for the following property: {entity}. Only do so if the Ontology or RAG clearly support constraints. If not, return the following string: 'SHACL shapes not found'." },
        { "role": "user", "content": "## Ontology:" },
        { "role": "user", "content": "{ontology_info}" },
        { "role": "user", "content": "## RAG:" },
        { "role": "user", "content": "{rag}" },
        { "role": "user", "content": "## 20 previous SHACL shapes:" },
        { "role": "user", "content": "{shacl_history}" }
    ],
    "generator_agent_property_with_error": [
        { "role": "system", "content": "You are an expert in generating SHACL restrictions for ObjectProperties and DataTypeProperties, using ontology and RAG context. You must strictly follow the evidence in the RAG or ontology to determine the constraints." },
        
        { "role": "system", "content": "## CONDITIONS OF GENERATION" },
        { "role": "system", "content": "1. Only generate SHACL shapes if you clearly identify constraints for the property in the Ontology or the RAG context. Do NOT guess or invent constraints." },
        { "role": "system", "content": "2. If no SHACL constraints are clearly stated or implied, return exactly this string: 'SHACL shapes not found'." },
        
        { "role": "system", "content": "3. If constraints are found, generate a SHACL PropertyShape starting like this: era-sh:(PropertyName) a sh:PropertyShape ;" },
        { "role": "system", "content": "4. Additionally, generate an applicability SPARQLConstraint Shape starting like this: era-sh:(PropertyName + 'Applicability') a sh:SPARQLConstraint ; if you find explicit applicability rules in the RAG or ontology." },
      
        { "role": "system", "content": "5. Each SHACL shape (PropertyShape or SPARQLConstraint) must include these fields when supported by the data:\n- era:affectedClass\n- era:affectedProperty\n- era:scope (default: local)\n- sh:path\n- sh:message\n- sh:severity (default: sh:Violation)." },
        { "role": "system", "content": "6. PropertyShapes must also include **at least** a field such as:\n- era:rinfIndex\n- rdfs:comment\n- sh:maxCount\n- sh:nodeKind sh:IRI\n- sh:class\n- sh:minCount\n- sh:datatype\n- sh:in\n- sh:pattern\n- sh:hasValue..." },
        { "role": "system", "content": "7. SPARQLConstraint shapes must also include **sh:select** with a valid SPARQL query." },

        { "role": "system", "content": "8. Use only URIs and terms present in the ontology. Do NOT fabricate URIs. Do not add example comments or placeholders." },
        { "role": "system", "content": "9. Respond only with the new SHACL restrictions in .ttl format. No explanations, no prefixes, no text before or after." },
      
        { "role": "system", "content": "## FEW-SHOT EXAMPLES" },
        { "role": "user", "content": "1. Generate SHACL restrictions for the following property: era:EtcsInfillLineAccess Ontology: | Sujeto | Predicado | Objeto | | http://data.europa.eu/949/etcsInfillLineAccess | http://www.w3.org/1999/02/22-rdf-syntax-ns#type | http://www.w3.org/2002/07/owl#DatatypeProperty | http://data.europa.eu/949/etcsInfillLineAccess | http://www.w3.org/1999/02/22-rdf-syntax-ns#type | http://www.w3.org/2002/07/owl#FunctionalProperty | http://data.europa.eu/949/etcsInfillLineAccess | http://www.w3.org/2000/01/rdf-schema#subPropertyOf | http://data.europa.eu/949/tsiCompliantTrainProtectionSystemDataParameter | http://data.europa.eu/949/etcsInfillLineAccess | http://www.w3.org/2000/01/rdf-schema#domain | nf6272deb04bb4e7fba07ae28374f1904b352 | http://data.europa.eu/949/etcsInfillLineAccess | http://www.w3.org/2000/01/rdf-schema#range | http://www.w3.org/2001/XMLSchema#boolean | http://data.europa.eu/949/etcsInfillLineAccess | http://data.europa.eu/949/XMLName | CPE_Infill | http://data.europa.eu/949/etcsInfillLineAccess | http://data.europa.eu/949/applicable | Y/N/NYA | http://data.europa.eu/949/etcsInfillLineAccess | http://data.europa.eu/949/dependencyNote | A value has to be provided when ETCS is present (a value is provided on 1.1.1.3.2.1) and the ETCS level is 1. | http://data.europa.eu/949/etcsInfillLineAccess | http://data.europa.eu/949/legalDeadline | 12 months after publication of Article 7 Guide for OP tracks | http://data.europa.eu/949/etcsInfillLineAccess | http://data.europa.eu/949/legalDeadline | In accordance with Implementing Decision 2014/880/EU and by 16 March 2019 at the latest | http://data.europa.eu/949/etcsInfillLineAccess | http://data.europa.eu/949/rinfIndex | 1.1.1.3.2.3 | http://data.europa.eu/949/etcsInfillLineAccess | http://data.europa.eu/949/rinfIndex | 1.2.1.1.1.3 | http://data.europa.eu/949/etcsInfillLineAccess | http://data.europa.eu/949/shaclShapeValidationRule | http://data.europa.eu/949/shapes/EtcsInfillLineAccess | http://data.europa.eu/949/etcsInfillLineAccess | http://data.europa.eu/949/shaclShapeValidationRule | http://data.europa.eu/949/shapes/EtcsInfillLineAccessApplicability | http://data.europa.eu/949/etcsInfillLineAccess | http://purl.org/dc/terms/created | 2021-08-08 | http://data.europa.eu/949/etcsInfillLineAccess | http://purl.org/dc/terms/modified | 2021-09-12 | http://data.europa.eu/949/etcsInfillLineAccess | http://purl.org/dc/terms/modified | 2025-02-28 | http://data.europa.eu/949/etcsInfillLineAccess | http://purl.org/dc/terms/modified | 2025-03-04 | http://data.europa.eu/949/etcsInfillLineAccess | http://purl.org/dc/terms/relation | http://data.europa.eu/949/etcsLevelType | http://data.europa.eu/949/etcsInfillLineAccess | http://purl.org/dc/terms/source | http://data.europa.eu/eli/reg_impl/2023/1695/oj | http://data.europa.eu/949/etcsInfillLineAccess | http://www.w3.org/2000/01/rdf-schema#comment | Indication whether infill is required to access the line for safety reasons. | http://data.europa.eu/949/etcsInfillLineAccess | http://www.w3.org/2000/01/rdf-schema#isDefinedBy | http://data.europa.eu/949/ | http://data.europa.eu/949/etcsInfillLineAccess | http://www.w3.org/2000/01/rdf-schema#label | ETCS infill necessary for line access | http://data.europa.eu/949/etcsInfillLineAccess | http://www.w3.org/2003/06/sw-vocab-status/ns#term_status | stable | http://data.europa.eu/949/etcsInfillLineAccess | http://www.w3.org/2004/02/skos/core#scopeNote | As indicated in CCS TSI section 7.2.9.1, an ETCS Level 1 trackside application may require that the on-board is equipped with the corresponding in-fill data transmission (Euroloop or radio) if the release speed is set to zero for safety reasons. See: TSI CCS 7.2.9.1 & 4.2.3 | RAG: <table><tr><td>Number</td><td>1.1.1.3.2.3</td></tr><tr><td>Title</td><td>ETCS<br/> infill necessary for line access</td></tr><tr><td>XML Name</td><td>SOL<br/> Track Parameter CPE_Infill</td></tr><tr><td>Definition</td><td>Indication whether infill is required to access the line for safety reasons.</td></tr><tr><td>Explanation on definition</td><td>Infill is the criterion for a vehicle to get access to the network .line.</td></tr><tr><td>Applicable</td><td>Y/N/NYA</td></tr><tr><td>Explanation on applicability: Only<br/> applicable when selected value for 1.1.1.3.2.1 is \u20181\u2019.</td></tr><tr><td>Can be<br/> repeated</td><td>N</td></tr><tr><td>Data<br/> presentation</td><td>Single selection from the predefined list: Y / N</td></tr><tr><td>General<br/> Explanations</td><td>As<br/> indicated in CCS TSI section 7.2.6 an ETCS Level 1 trackside application may require<br/> that the on-board is equipped with the corresponding in-fill data transmission<br/> (Euroloop or radio) if the release speed is set to zero for safety reasons.</td></tr><tr><td>Reference</td><td>CCS<br/> TSI: 7.2.6 and 4.2.3</td></tr></table> 1.1.1.3.2.3 CPE_Infill / ETCS infill necessary for line access 1.1.1.3.2.4 CPE_InfillLineSide / ETCS infill installed lineside <table><tr><td>Number</td><td>1.1.1.3.2.4</td></tr><tr><td>Title</td><td>ETCS<br/> infill installed line-side</td></tr><tr><td>XML Name</td><td>SOL<br/> Track Parameter CPE_InfillLineSide</td></tr><tr><td>Definition</td><td>Information about installed trackside equipment capable to transmit infill<br/> information by loop or GSM-R for level 1 installation.</td></tr><tr><td>Applicable</td><td>Y/N/NYA</td></tr><tr><td>Explanation on applicability: Only<br/> applicable when selected value for 1.1.1.3.2.1 is \u20181\u2019.</td></tr><tr><td>Can be<br/> repeated</td><td>N</td></tr><tr><td>Data<br/> presentation</td><td>Single<br/> choice from the predefined list: None Loop GSM-R radio infill Loop &amp;<br/> GSM-R radio infill</td></tr><tr><td>Reference</td><td>CCS<br/> TSI: 4.2.2</td></tr></table> [9] Line under construction" },
        { "role": "assistant", "content": "era-sh:EtcsInfillLineAccess a sh:PropertyShape ; era:affectedClass era:RunningTrack ; era:affectedProperty era:etcsInfillLineAccess ; era:rinfIndex \"1.1.1.3.2.3\", \"1.2.1.1.1.3\" ; era:scope \"local\" ; rdfs:comment \"Indication whether infill is required to access the line for safety reasons.\"@en ; sh:datatype xsd:boolean ; sh:maxCount 1 ; sh:message \"etcsInfillLineAccess (1.1.1.3.2.3, 1.2.1.1.1.3): Each track or subset with common characteristics may define the existence of a ETCS infill necessary for line access. This error is due to having more than one indication of ETCS infill necessary for line access value or having an indication of ETCS infill necessary for line access value that is not Y/N (boolean).\"@en ; sh:path era:etcsInfillLineAccess ; sh:severity sh:Violation . era-sh:EtcsInfillLineAccessApplicability a sh:SPARQLConstraint ; era:affectedClass era:RunningTrack ; era:affectedProperty era:etcsInfillLineAccess ; era:rinfIndex \"1.1.1.3.2.3\", \"1.2.1.1.1.3\" ; era:scope \"local\" ; rdfs:comment \"Only applicable when selected value for 1.1.1.3.2.1 (ETCS present).\"@en ; sh:message \"etcsInfillLineAccess (1.1.1.3.2.3, 1.2.1.1.1.3):The track or subset with common characteristics {{$this}} ({{?label}}), has a 'ETCS Level Type' defined which makes the etcsInfillLineAccess parameter applicable. This error is due to {{$this}} not having a value for such a parameter.\"@en ; sh:prefixes era: ; sh:select \"\"\" PREFIX era: <http://data.europa.eu/949/> PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#> SELECT DISTINCT $this ?label WHERE {{ $this era:etcs ?etcs. ?etcs era:etcsLevelType ?etcsType. OPTIONAL{{$this rdfs:label ?label}} . FILTER NOT EXISTS {{$this era:etcsInfillLineAccess ?value}} . }} \"\"\" ; sh:severity sh:Violation .        " },
        { "role": "user", "content": "2. Generate SHACL restrictions for the following property: era:HasPlatformCurvature Ontology: <http://data.europa.eu/949/etcsInfillLineAccess> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www.w3.org/2002/07/owl#DatatypeProperty> . <http://data.europa.eu/949/etcsInfillLineAccess> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www.w3.org/2002/07/owl#FunctionalProperty> . <http://data.europa.eu/949/etcsInfillLineAccess> <http://www.w3.org/2000/01/rdf-schema#subPropertyOf> <http://data.europa.eu/949/tsiCompliantTrainProtectionSystemDataParameter> . <http://data.europa.eu/949/etcsInfillLineAccess> <http://www.w3.org/2000/01/rdf-schema#domain> nf9cd43bdd37242698f864f7a5238ecaeb352 . <http://data.europa.eu/949/etcsInfillLineAccess> <http://www.w3.org/2000/01/rdf-schema#range> <http://www.w3.org/2001/XMLSchema#boolean> . <http://data.europa.eu/949/etcsInfillLineAccess> <http://data.europa.eu/949/XMLName> \"CPE_Infill\" . <http://data.europa.eu/949/etcsInfillLineAccess> <http://data.europa.eu/949/applicable> \"Y/N/NYA\" . <http://data.europa.eu/949/etcsInfillLineAccess> <http://data.europa.eu/949/dependencyNote> \"A value has to be provided when ETCS is present (a value is provided on 1.1.1.3.2.1) and the ETCS level is 1.\" . <http://data.europa.eu/949/etcsInfillLineAccess> <http://data.europa.eu/949/legalDeadline> \"12 months after publication of Article 7 Guide for OP tracks\" . <http://data.europa.eu/949/etcsInfillLineAccess> <http://data.europa.eu/949/legalDeadline> \"In accordance with Implementing Decision 2014/880/EU and by 16 March 2019 at the latest\" . <http://data.europa.eu/949/etcsInfillLineAccess> <http://data.europa.eu/949/rinfIndex> \"1.1.1.3.2.3\" . <http://data.europa.eu/949/etcsInfillLineAccess> <http://data.europa.eu/949/rinfIndex> \"1.2.1.1.1.3\" . <http://data.europa.eu/949/etcsInfillLineAccess> <http://data.europa.eu/949/shaclShapeValidationRule> <http://data.europa.eu/949/shapes/EtcsInfillLineAccess> . <http://data.europa.eu/949/etcsInfillLineAccess> <http://data.europa.eu/949/shaclShapeValidationRule> <http://data.europa.eu/949/shapes/EtcsInfillLineAccessApplicability> . <http://data.europa.eu/949/etcsInfillLineAccess> <http://purl.org/dc/terms/created> \"2021-08-08\" . <http://data.europa.eu/949/etcsInfillLineAccess> <http://purl.org/dc/terms/modified> \"2021-09-12\" . <http://data.europa.eu/949/etcsInfillLineAccess> <http://purl.org/dc/terms/modified> \"2025-02-28\" . <http://data.europa.eu/949/etcsInfillLineAccess> <http://purl.org/dc/terms/modified> \"2025-03-04\" . <http://data.europa.eu/949/etcsInfillLineAccess> <http://purl.org/dc/terms/relation> <http://data.europa.eu/949/etcsLevelType> . <http://data.europa.eu/949/etcsInfillLineAccess> <http://purl.org/dc/terms/source> <http://data.europa.eu/eli/reg_impl/2023/1695/oj> . <http://data.europa.eu/949/etcsInfillLineAccess> <http://www.w3.org/2000/01/rdf-schema#comment> \"Indication whether infill is required to access the line for safety reasons.\" . <http://data.europa.eu/949/etcsInfillLineAccess> <http://www.w3.org/2000/01/rdf-schema#isDefinedBy> <http://data.europa.eu/949/> . <http://data.europa.eu/949/etcsInfillLineAccess> <http://www.w3.org/2000/01/rdf-schema#label> \"ETCS infill necessary for line access\" . <http://data.europa.eu/949/etcsInfillLineAccess> <http://www.w3.org/2003/06/sw-vocab-status/ns#term_status> \"stable\" . <http://data.europa.eu/949/etcsInfillLineAccess> <http://www.w3.org/2004/02/skos/core#scopeNote> \"As indicated in CCS TSI section 7.2.9.1, an ETCS Level 1 trackside application may require that the on-board is equipped with the corresponding in-fill data transmission (Euroloop or radio) if the release speed is set to zero for safety reasons.\" . |  RAG: ILL_MinRadHorzCurve / Minimum radius of horizontal curve 1.2.2.0.3.3 ILL_MinRadVertCurve / Minimum radius of vertical curve ILL_MinRadHorzCurve / Minimum radius of horizontal curve 1.1.1.1.3.7 ILL_MinRadHorzCurve / Minimum radius of horizontal curve ILL_MinRadVertCurve / Minimum radius of vertical curve" },
        { "role": "assistant", "content": "era-sh:HasPlatformCurvature a sh:PropertyShape ; era:affectedClass era:PlatformEdge ; era:affectedProperty era:hasPlatformCurvature ; era:rinfIndex \"1.2.1.0.6.8 \" ; era:scope \"local\" ; rdfs:comment \"Indication of the existence of the curvature of the platform.\"@en ; sh:datatype xsd:boolean ; sh:maxCount 1 ; sh:message \"hasPlatformCurvature (1.2.1.0.6.8): Each Platform must have at most one hasPlatformCurvature value. This error may be caused due to having a platform with multiple hasPlatformCurvature values or having a value that is not a boolean.\"@en ; sh:path era:hasPlatformCurvature ; sh:severity sh:Violation .        " },
        { "role": "user", "content": "3. Generate SHACL restrictions for the following property: era:vehicleTypeMaximumSpeed Ontology: <http://data.europa.eu/949/vehicleTypeMaximumSpeed> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www.w3.org/2002/07/owl#DatatypeProperty> . <http://data.europa.eu/949/vehicleTypeMaximumSpeed> <http://www.w3.org/2000/01/rdf-schema#subPropertyOf> <http://data.europa.eu/949/vehicleTypeTechnicalDataCharacteristic> . <http://data.europa.eu/949/vehicleTypeMaximumSpeed> <http://www.w3.org/2000/01/rdf-schema#domain> <http://data.europa.eu/949/MaximumSpeedAndCantDeficiency> . <http://data.europa.eu/949/vehicleTypeMaximumSpeed> <http://www.w3.org/2000/01/rdf-schema#range> <http://www.w3.org/2001/XMLSchema#integer> . <http://data.europa.eu/949/vehicleTypeMaximumSpeed> <http://data.europa.eu/949/eratvIndex> \"4.6.4\" . <http://data.europa.eu/949/vehicleTypeMaximumSpeed> <http://purl.org/dc/terms/created> \"2023-04-05\" . <http://data.europa.eu/949/vehicleTypeMaximumSpeed> <http://purl.org/dc/terms/modified> \"2025-02-18\" . <http://data.europa.eu/949/vehicleTypeMaximumSpeed> <http://purl.org/dc/terms/replaces> <http://data.europa.eu/949/maximumSpeedAndCantDeficiency> . <http://data.europa.eu/949/vehicleTypeMaximumSpeed> <http://www.w3.org/2000/01/rdf-schema#comment> \"Part of the combination of maximum speed and maximum cant deficiency for which the vehicle was assessed. Corresponds to the maximum speed.\" . <http://data.europa.eu/949/vehicleTypeMaximumSpeed> <http://www.w3.org/2000/01/rdf-schema#isDefinedBy> <http://data.europa.eu/949/> . <http://data.europa.eu/949/vehicleTypeMaximumSpeed> <http://www.w3.org/2000/01/rdf-schema#label> \"Vehicle type maximum speed\" . <http://data.europa.eu/949/vehicleTypeMaximumSpeed> <http://www.w3.org/2003/06/sw-vocab-status/ns#term_status> \"stable\" .  |    RAG: <SOLTrackParameter Value=\"351\" IsApplicable=\"Y\" ID=\"IPP_MaxSpeed\"> <table><tr><td>Number</td><td>1.1.1.1.4.2</td></tr><tr><td>Title</td><td>Cant<br/> deficiency</td></tr><tr><td>XML Name</td><td>SOL<br/> Track Parameter ITP_CantDeficiency</td></tr><tr><td>Definition</td><td>Maximum cant deficiency expressed in millimetres defined as difference between the applied cant and a higher equilibrium cant the line has been designed for</td></tr><tr><td>Applicable</td><td>Y/NYA</td></tr><tr><td>Can be<br/> repeated</td><td>N</td></tr><tr><td>Data<br/> presentation</td><td>[+/-] [NNN]</td></tr><tr><td>Explanations on data presentation: In<br/> case of positive value of cant deficiency or zero symbol \u2018+\u2019 shall be applied. In<br/> case of negative cant deficiency symbol \u2018-\u2018 has to be selected. Value of the cant<br/> deficiency shall be given in millimetres. In case of lateral uncompensated<br/> acceleration on a 1435 mm track gauge of 1.0 m/s 2 the value<br/> of 153 mm may be published.</td></tr><tr><td>References</td><td>INF<br/> TSI: 4.2.4.3 HS INF TSI: 4.2.8 CR INF TSI: 4.2.5.4</td></tr></table> CTD_MaxDistConsecutiveAxles / Maximum permitted distance between two consecutive axles in case of TSI non-compliance <table><tr><td>Number</td><td>1.1.1.1.2.5</td></tr><tr><td>Title</td><td>Maximum permitted speed</td></tr><tr><td>XML Name</td><td>SOL<br/> Track Parameter IPP_MaxSpeed</td></tr><tr><td>Definition</td><td>Nominal maximum operational speed on the line as a result of INF, ENE and CCS subsystem characteristics expressed in kilometres/hour.</td></tr><tr><td>Explanation on definition</td><td>\u2018Speed on the line\u2019 shall be understood as speed on the track of the section of line<br/> in question.</td></tr><tr><td>Applicable</td><td>Y/NYA</td></tr><tr><td>Can be<br/> repeated</td><td>N</td></tr><tr><td>Data<br/> presentation</td><td>[NNN]</td></tr><tr><td>Limit values</td><td>min=0, max=500</td></tr><tr><td>References</td><td>INF<br/> TSI: All HS and<br/> CR TSIs (ENE, CCS)</td></tr><tr><td>Example</td><td>When INF<br/> allows 160 km/h, ENE allows 100 km/h and CCS allows 120 km/h, the max permitted<br/> speed on this track of this section of line is 100 km/h. When for<br/> freight trains operation the maximum permitted speed is 100 km/h, and for passenger<br/> trains it is 160 km/h, as the value of maximum permitted speed shall be presented<br/> 160 km/h only.</td></tr></table>" },
        { "role": "assistant", "content": "SHACL shapes not found" },
        { "role": "user", "content": "Generate SHACL restrictions for the following property: {entity}. Only do so if the Ontology or RAG clearly support constraints. If not, return the following string: 'SHACL shapes not found'." },
        { "role": "user", "content": "The last generated this SHACL constraint contained the following error: {error}. Try to prevent this error from occurring." },
        { "role": "user", "content": "## Ontology:" },
        { "role": "user", "content": "{ontology_info}" },
        { "role": "user", "content": "## RAG:" },
        { "role": "user", "content": "{rag}" },
        { "role": "user", "content": "## 20 previous SHACL shapes:" },
        { "role": "user", "content": "{shacl_history}" }
    ]
      
}
  